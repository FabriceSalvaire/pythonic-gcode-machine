

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PythonicGcodeMachine.PythonLexYacc.yacc &mdash; PythonicGcodeMachine 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../static/css/PythonicGcodeMachine.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> PythonicGcodeMachine
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">1. Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#what-is-pythonicgcodemachine">1.1. What is PythonicGcodeMachine ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#how-is-pythonicgcodemachine-licensed">1.2. How is PythonicGcodeMachine licensed ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#going-further-with-pythonicgcodemachine">1.3. Going further with PythonicGcodeMachine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#which-platforms-are-supported-by-pythonicgcodemachine">1.4. Which platforms are supported by PythonicGcodeMachine ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#how-to-install-pythonicgcodemachine">1.5. How to install PythonicGcodeMachine ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#which-version-of-python-is-required">1.6. Which version of Python is required ?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../news.html">2. News</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../news.html#v0-2018-12-22">2.1. V0 2018-12-22</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap.html">3. Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">4. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#on-windows">4.1. On Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#on-linux">4.2. On Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#on-osx">4.3. On OSX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installation-from-pypi-repository">4.4. Installation from PyPi Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#install-a-more-recent-version-from-github">4.5. Install a more recent version from Github</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installation-from-source">4.6. Installation from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#dependencies">4.7. Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">5. User FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html#how-to-get-help-or-report-an-issue">5.1. How to get help or report an issue ?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">6. Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/gcode/index.html">6.1. Gcode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/gcode/annotate-gcode.html">6.1.1. Annotate a G-code program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/gcode/generate-gcode.html">6.1.2. Generate a G-code program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/gcode/query-gcode.html">6.1.3. Query G-codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../gcode-reference/index.html">7. G-code Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html">7.1. RS-274 G-code Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#history">7.1.1. History</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#overview">7.1.2. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#language-view-of-a-machining-center">7.1.3. Language View of a Machining Center</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#parameters">7.1.3.1. Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#coordinate-systems">7.1.3.2. Coordinate Systems</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#format-of-a-line">7.1.4. Format of a Line</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#line-number">7.1.4.1. Line Number</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#word">7.1.4.2. Word</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#number">7.1.4.3. Number</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#parameter-value">7.1.4.4. Parameter Value</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#expressions-and-binary-operations">7.1.4.5. Expressions and Binary Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#unary-operation-value">7.1.4.6. Unary Operation Value</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#parameter-setting">7.1.4.7. Parameter Setting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#comments-and-messages">7.1.4.8. Comments and Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#item-repeats">7.1.4.9. Item Repeats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#item-order">7.1.4.10. Item order</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#commands-and-machine-modes">7.1.4.11. Commands and Machine Modes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#modal-groups">7.1.5. Modal Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#g-and-input-codes">7.1.6. G and Input Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gcode-reference/rs-274/index.html#order-of-execution">7.1.7. Order of Execution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../design-notes.html">8. Design Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../design-notes.html#g-code-parser">8.1. G-Code Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design-notes.html#g-code-flavours">8.2. G-code flavours</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design-notes.html#g-code-generation-and-simulation">8.3. G-code Generation and Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design-notes.html#computational-geometry-engine">8.4. Computational Geometry Engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../design-notes.html#list-of-the-main-open-source-computational-geometry-algorithms-libraries">8.4.1. List of the Main Open Source Computational Geometry Algorithms Libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../design-notes.html#the-computational-geometry-algorithms-library">8.4.1.1. The Computational Geometry Algorithms Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../design-notes.html#open-cascade">8.4.1.2. Open CASCADE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../design-notes.html#g-code-visualisation">8.5. G-code Visualisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference-manual.html">9. API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/PythonicGcodeMachine.html">9.1. PythonicGcodeMachine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Gcode.html">9.1.1. Gcode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Gcode/Fanuc.html">9.1.1.1. Fanuc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Gcode/Heidenhain.html">9.1.1.2. Heidenhain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Gcode/LinuxCnc.html">9.1.1.3. LinuxCnc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Gcode/MachineKit.html">9.1.1.4. MachineKit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Gcode/Rs274.html">9.1.1.5. Rs274</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/PythonicGcodeMachine/Machine.html">9.1.2. Machine</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/PythonicGcodeMachine/PythonLexYacc.html">9.1.3. PythonLexYacc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/PythonLexYacc/lex.html">9.1.3.1. lex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html">9.1.3.2. yacc</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference-manual.html#indexes">9.2. Indexes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">10. Development &amp; Community</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#how-you-can-help">10.1. How you can help ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#contributors">10.2. Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to-refer.html">11. How to Refer to PythonicGcodeMachine ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../donate.html">12. How to Help Further ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../related-projects.html">13. Related Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../related-projects.html#g-code-tools">13.1. G-code Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../related-projects.html#cam-tools">13.2. CAM Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">14. Bibliography</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../bibliography.html#g-code">14.1. G-Code</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PythonicGcodeMachine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>PythonicGcodeMachine.PythonLexYacc.yacc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for PythonicGcodeMachine.PythonLexYacc.yacc</h1><div class="highlight"><pre>
<span></span><span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># ply: yacc.py</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2001-2018</span>
<span class="c1"># David M. Beazley (Dabeaz LLC)</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1"># * Redistributions of source code must retain the above copyright notice,</span>
<span class="c1">#   this list of conditions and the following disclaimer.</span>
<span class="c1"># * Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1">#   this list of conditions and the following disclaimer in the documentation</span>
<span class="c1">#   and/or other materials provided with the distribution.</span>
<span class="c1"># * Neither the name of the David Beazley or Dabeaz LLC may be used to</span>
<span class="c1">#   endorse or promote products derived from this software without</span>
<span class="c1">#  specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c1"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c1"># OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c1"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="c1"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="c1"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c1"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c1"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># This implements an LR parser that is constructed from grammar rules defined</span>
<span class="c1"># as Python functions. The grammar is specified by supplying the BNF inside</span>
<span class="c1"># Python documentation strings.  The inspiration for this technique was borrowed</span>
<span class="c1"># from John Aycock&#39;s Spark parsing system.  PLY might be viewed as cross between</span>
<span class="c1"># Spark and the GNU bison utility.</span>
<span class="c1">#</span>
<span class="c1"># The current implementation is only somewhat object-oriented. The</span>
<span class="c1"># LR parser itself is defined in terms of an object (which allows multiple</span>
<span class="c1"># parsers to co-exist).  However, most of the variables used during table</span>
<span class="c1"># construction are defined in terms of global variables.  Users shouldn&#39;t</span>
<span class="c1"># notice unless they are trying to define multiple parsers at the same</span>
<span class="c1"># time using threads (in which case they should have their head examined).</span>
<span class="c1">#</span>
<span class="c1"># This implementation supports both SLR and LALR(1) parsing.  LALR(1)</span>
<span class="c1"># support was originally implemented by Elias Ioup (ezioup@alumni.uchicago.edu),</span>
<span class="c1"># using the algorithm found in Aho, Sethi, and Ullman &quot;Compilers: Principles,</span>
<span class="c1"># Techniques, and Tools&quot; (The Dragon Book).  LALR(1) has since been replaced</span>
<span class="c1"># by the more efficient DeRemer and Pennello algorithm.</span>
<span class="c1">#</span>
<span class="c1"># :::::::: WARNING :::::::</span>
<span class="c1">#</span>
<span class="c1"># Construction of LR parsing tables is fairly complicated and expensive.</span>
<span class="c1"># To make this module run fast, a *LOT* of work has been put into</span>
<span class="c1"># optimization---often at the expensive of readability and what might</span>
<span class="c1"># consider to be good Python &quot;coding style.&quot;   Modify the code at your</span>
<span class="c1"># own risk!</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">__version__</span>    <span class="o">=</span> <span class="s1">&#39;3.11&#39;</span>
<span class="n">__tabversion__</span> <span class="o">=</span> <span class="s1">&#39;3.10&#39;</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1">#                     === User configurable parameters ===</span>
<span class="c1">#</span>
<span class="c1"># Change these to modify the default behavior of yacc (if you wish)</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="n">yaccdebug</span>   <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># Debugging mode.  If set, yacc generates a</span>
                               <span class="c1"># a &#39;parser.out&#39; file in the current directory</span>

<span class="n">debug_file</span>  <span class="o">=</span> <span class="s1">&#39;parser.out&#39;</span>     <span class="c1"># Default name of the debugging file</span>
<span class="n">tab_module</span>  <span class="o">=</span> <span class="s1">&#39;parsetab&#39;</span>       <span class="c1"># Default name of the table module</span>
<span class="n">default_lr</span>  <span class="o">=</span> <span class="s1">&#39;LALR&#39;</span>           <span class="c1"># Default LR table generation method</span>

<span class="n">error_count</span> <span class="o">=</span> <span class="mi">3</span>                <span class="c1"># Number of symbols that must be shifted to leave recovery mode</span>

<span class="n">yaccdevel</span>   <span class="o">=</span> <span class="kc">False</span>            <span class="c1"># Set to True if developing yacc.  This turns off optimized</span>
                               <span class="c1"># implementations of certain functions.</span>

<span class="n">resultlimit</span> <span class="o">=</span> <span class="mi">40</span>               <span class="c1"># Size limit of results when running in debug mode.</span>

<span class="n">pickle_protocol</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># Protocol to use when writing pickle files</span>

<span class="c1"># String type-checking compatibility</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">string_types</span> <span class="o">=</span> <span class="n">basestring</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">string_types</span> <span class="o">=</span> <span class="nb">str</span>

<span class="n">MAXINT</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>

<span class="c1"># This object is a stand-in for a logging object created by the</span>
<span class="c1"># logging module.   PLY will use this by default to create things</span>
<span class="c1"># such as the parser.out file.  If a user wants more detailed</span>
<span class="c1"># information, they can create their own logging object and pass</span>
<span class="c1"># it into PLY.</span>

<div class="viewcode-block" id="PlyLogger"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.PlyLogger">[docs]</a><span class="k">class</span> <span class="nc">PlyLogger</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>

<div class="viewcode-block" id="PlyLogger.debug"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.PlyLogger.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

    <span class="n">info</span> <span class="o">=</span> <span class="n">debug</span>

<div class="viewcode-block" id="PlyLogger.warning"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.PlyLogger.warning">[docs]</a>    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlyLogger.error"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.PlyLogger.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

    <span class="n">critical</span> <span class="o">=</span> <span class="n">debug</span></div>

<span class="c1"># Null logger is used when no output is generated. Does nothing.</span>
<div class="viewcode-block" id="NullLogger"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.NullLogger">[docs]</a><span class="k">class</span> <span class="nc">NullLogger</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<span class="c1"># Exception raised for yacc-related errors</span>
<div class="viewcode-block" id="YaccError"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccError">[docs]</a><span class="k">class</span> <span class="nc">YaccError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="c1"># Format the result message that the parser produces when running in debug mode.</span>
<div class="viewcode-block" id="format_result"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.format_result">[docs]</a><span class="k">def</span> <span class="nf">format_result</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="n">repr_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">repr_str</span><span class="p">:</span>
        <span class="n">repr_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">repr_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">resultlimit</span><span class="p">:</span>
        <span class="n">repr_str</span> <span class="o">=</span> <span class="n">repr_str</span><span class="p">[:</span><span class="n">resultlimit</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; ...&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> @ 0x</span><span class="si">%x</span><span class="s1">&gt; (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">repr_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>

<span class="c1"># Format stack entries when the parser is running in debug mode</span>
<div class="viewcode-block" id="format_stack_entry"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.format_stack_entry">[docs]</a><span class="k">def</span> <span class="nf">format_stack_entry</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="n">repr_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">repr_str</span><span class="p">:</span>
        <span class="n">repr_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">repr_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">repr_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> @ 0x</span><span class="si">%x</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">))</span></div>

<span class="c1"># Panic mode error recovery support.   This feature is being reworked--much of the</span>
<span class="c1"># code here is to offer a deprecation/backwards compatible transition</span>

<span class="n">_errok</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_restart</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_warnmsg</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;PLY: Don&#39;t use global functions errok(), token(), and restart() in p_error().</span>
<span class="s1">Instead, invoke the methods on the associated parser instance:</span>

<span class="s1">    def p_error(p):</span>
<span class="s1">        ...</span>
<span class="s1">        # Use parser.errok(), parser.token(), parser.restart()</span>
<span class="s1">        ...</span>

<span class="s1">    parser = yacc.yacc()</span>
<span class="s1">&#39;&#39;&#39;</span>

<div class="viewcode-block" id="errok"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.errok">[docs]</a><span class="k">def</span> <span class="nf">errok</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">_warnmsg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_errok</span><span class="p">()</span></div>

<div class="viewcode-block" id="restart"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.restart">[docs]</a><span class="k">def</span> <span class="nf">restart</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">_warnmsg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_restart</span><span class="p">()</span></div>

<div class="viewcode-block" id="token"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.token">[docs]</a><span class="k">def</span> <span class="nf">token</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">_warnmsg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_token</span><span class="p">()</span></div>

<span class="c1"># Utility function to call the p_error() function with some deprecation hacks</span>
<div class="viewcode-block" id="call_errorfunc"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.call_errorfunc">[docs]</a><span class="k">def</span> <span class="nf">call_errorfunc</span><span class="p">(</span><span class="n">errorfunc</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_errok</span><span class="p">,</span> <span class="n">_token</span><span class="p">,</span> <span class="n">_restart</span>
    <span class="n">_errok</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">errok</span>
    <span class="n">_token</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">token</span>
    <span class="n">_restart</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">restart</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">errorfunc</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">_errok</span><span class="p">,</span> <span class="n">_token</span><span class="p">,</span> <span class="n">_restart</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">r</span></div>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1">#                        ===  LR Parsing Engine ===</span>
<span class="c1">#</span>
<span class="c1"># The following classes are used for the LR parser itself.  These are not</span>
<span class="c1"># used during table construction and are independent of the actual LR</span>
<span class="c1"># table generation algorithm</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1"># This class is used to hold non-terminal grammar symbols during parsing.</span>
<span class="c1"># It normally has the following attributes set:</span>
<span class="c1">#        .type       = Grammar symbol type</span>
<span class="c1">#        .value      = Symbol value</span>
<span class="c1">#        .lineno     = Starting line number</span>
<span class="c1">#        .endlineno  = Ending line number (optional, set automatically)</span>
<span class="c1">#        .lexpos     = Starting lex position</span>
<span class="c1">#        .endlexpos  = Ending lex position (optional, set automatically)</span>

<div class="viewcode-block" id="YaccSymbol"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccSymbol">[docs]</a><span class="k">class</span> <span class="nc">YaccSymbol</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<span class="c1"># This class is a wrapper around the objects actually passed to each</span>
<span class="c1"># grammar rule.   Index lookup and assignment actually assign the</span>
<span class="c1"># .value attribute of the underlying YaccSymbol object.</span>
<span class="c1"># The lineno() method returns the line number of a given</span>
<span class="c1"># item (or 0 if not defined).   The linespan() method returns</span>
<span class="c1"># a tuple of (startline,endline) representing the range of lines</span>
<span class="c1"># for a symbol.  The lexspan() method returns a tuple (lexpos,endlexpos)</span>
<span class="c1"># representing the range of positional information for a symbol.</span>

<div class="viewcode-block" id="YaccProduction"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction">[docs]</a><span class="k">class</span> <span class="nc">YaccProduction</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">)</span>

<div class="viewcode-block" id="YaccProduction.lineno"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.lineno">[docs]</a>    <span class="k">def</span> <span class="nf">lineno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;lineno&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="YaccProduction.set_lineno"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.set_lineno">[docs]</a>    <span class="k">def</span> <span class="nf">set_lineno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span></div>

<div class="viewcode-block" id="YaccProduction.linespan"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.linespan">[docs]</a>    <span class="k">def</span> <span class="nf">linespan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">startline</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;lineno&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">endline</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;endlineno&#39;</span><span class="p">,</span> <span class="n">startline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">startline</span><span class="p">,</span> <span class="n">endline</span></div>

<div class="viewcode-block" id="YaccProduction.lexpos"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.lexpos">[docs]</a>    <span class="k">def</span> <span class="nf">lexpos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="YaccProduction.set_lexpos"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.set_lexpos">[docs]</a>    <span class="k">def</span> <span class="nf">set_lexpos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">lexpos</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">lexpos</span></div>

<div class="viewcode-block" id="YaccProduction.lexspan"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.lexspan">[docs]</a>    <span class="k">def</span> <span class="nf">lexspan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">endpos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;endlexpos&#39;</span><span class="p">,</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">startpos</span><span class="p">,</span> <span class="n">endpos</span></div>

<div class="viewcode-block" id="YaccProduction.error"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.YaccProduction.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span></div></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                               == LRParser ==</span>
<span class="c1">#</span>
<span class="c1"># The LR Parsing engine.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRParser"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser">[docs]</a><span class="k">class</span> <span class="nc">LRParser</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lrtab</span><span class="p">,</span> <span class="n">errorf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="o">=</span> <span class="n">lrtab</span><span class="o">.</span><span class="n">lr_productions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">lrtab</span><span class="o">.</span><span class="n">lr_action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto</span> <span class="o">=</span> <span class="n">lrtab</span><span class="o">.</span><span class="n">lr_goto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span> <span class="o">=</span> <span class="n">errorf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaulted_states</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="LRParser.errok"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.errok">[docs]</a>    <span class="k">def</span> <span class="nf">errok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="LRParser.restart"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.restart">[docs]</a>    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">statestack</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">symstack</span><span class="p">[:]</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

    <span class="c1"># Defaulted state support.</span>
    <span class="c1"># This method identifies parser states where there is only one possible reduction action.</span>
    <span class="c1"># For such states, the parser can make a choose to make a rule reduction without consuming</span>
    <span class="c1"># the next look-ahead token.  This delayed invocation of the tokenizer can be useful in</span>
    <span class="c1"># certain kinds of advanced parsing situations where the lexer and parser interact with</span>
    <span class="c1"># each other or change states (i.e., manipulation of scope, lexer states, etc.).</span>
    <span class="c1">#</span>
    <span class="c1"># See:  http://www.gnu.org/software/bison/manual/html_node/Default-Reductions.html#Default-Reductions</span>
<div class="viewcode-block" id="LRParser.set_defaulted_states"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.set_defaulted_states">[docs]</a>    <span class="k">def</span> <span class="nf">set_defaulted_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaulted_states</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">actions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">actions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defaulted_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="LRParser.disable_defaulted_states"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.disable_defaulted_states">[docs]</a>    <span class="k">def</span> <span class="nf">disable_defaulted_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaulted_states</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="LRParser.parse"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tracking</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">or</span> <span class="n">yaccdevel</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">debug</span> <span class="o">=</span> <span class="n">PlyLogger</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsedebug</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">tracking</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tracking</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseopt</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">tracking</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseopt_notrack</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">tracking</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="p">)</span></div>


    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
    <span class="c1"># parsedebug().</span>
    <span class="c1">#</span>
    <span class="c1"># This is the debugging enabled version of parse().  All changes made to the</span>
    <span class="c1"># parsing engine should be made here.   Optimized versions of this function</span>
    <span class="c1"># are automatically created by the ply/ygen.py script.  This script cuts out</span>
    <span class="c1"># sections enclosed in markers such as this:</span>
    <span class="c1">#</span>
    <span class="c1">#      #--! DEBUG</span>
    <span class="c1">#      statements</span>
    <span class="c1">#      #--! DEBUG</span>
    <span class="c1">#</span>
    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

<div class="viewcode-block" id="LRParser.parsedebug"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.parsedebug">[docs]</a>    <span class="k">def</span> <span class="nf">parsedebug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tracking</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#--! parsedebug-start</span>
        <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>                         <span class="c1"># Current lookahead symbol</span>
        <span class="n">lookaheadstack</span> <span class="o">=</span> <span class="p">[]</span>                      <span class="c1"># Stack of lookahead symbols</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span>                    <span class="c1"># Local reference to action table (to avoid lookup on self.)</span>
        <span class="n">goto</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto</span>                      <span class="c1"># Local reference to goto table (to avoid lookup on self.)</span>
        <span class="n">prod</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span>               <span class="c1"># Local reference to production list (to avoid lookup on self.)</span>
        <span class="n">defaulted_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaulted_states</span> <span class="c1"># Local reference to defaulted states</span>
        <span class="n">pslice</span>  <span class="o">=</span> <span class="n">YaccProduction</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>           <span class="c1"># Production object passed to grammar rules</span>
        <span class="n">errorcount</span> <span class="o">=</span> <span class="mi">0</span>                           <span class="c1"># Used during error recovery</span>

        <span class="c1">#--! DEBUG</span>
        <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PLY: PARSE DEBUG START&#39;</span><span class="p">)</span>
        <span class="c1">#--! DEBUG</span>

        <span class="c1"># If no lexer was given, we will try to use the lex module</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lexer</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">lex</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">lexer</span>

        <span class="c1"># Set up the lexer and parser objects on pslice</span>
        <span class="n">pslice</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
        <span class="n">pslice</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># If input was supplied, pass to lexer</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lexer</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tokenfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Tokenize function</span>
            <span class="n">get_token</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">token</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_token</span> <span class="o">=</span> <span class="n">tokenfunc</span>

        <span class="c1"># Set the parser() token method (sometimes used in error recovery)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">get_token</span>

        <span class="c1"># Set up the state and symbol stacks</span>

        <span class="n">statestack</span> <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># Stack of parsing states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statestack</span> <span class="o">=</span> <span class="n">statestack</span>
        <span class="n">symstack</span>   <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># Stack of grammar symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symstack</span> <span class="o">=</span> <span class="n">symstack</span>

        <span class="n">pslice</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">symstack</span>         <span class="c1"># Put in the production</span>
        <span class="n">errtoken</span>   <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># Err token</span>

        <span class="c1"># The start state is assumed to be (0,$end)</span>

        <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>
        <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Get the next symbol on the input.  If a lookahead symbol</span>
            <span class="c1"># is already set, we just use that. Otherwise, we&#39;ll pull</span>
            <span class="c1"># the next token off of the lookaheadstack or from the lexer</span>

            <span class="c1">#--! DEBUG</span>
            <span class="n">debug</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">debug</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;State  : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="c1">#--! DEBUG</span>

            <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaulted_states</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lookahead</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">lookaheadstack</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">()</span>     <span class="c1"># Get the next token</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">lookahead</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>

                <span class="c1"># Check the action table</span>
                <span class="n">ltype</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">state</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ltype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">defaulted_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
                <span class="c1">#--! DEBUG</span>
                <span class="n">debug</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Defaulted state </span><span class="si">%s</span><span class="s1">: Reduce using </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">)</span>
                <span class="c1">#--! DEBUG</span>

            <span class="c1">#--! DEBUG</span>
            <span class="n">debug</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stack  : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> . </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">xx</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">symstack</span><span class="p">][</span><span class="mi">1</span><span class="p">:]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)))</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="c1">#--! DEBUG</span>

            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># shift a symbol on the stack</span>
                    <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">t</span>

                    <span class="c1">#--! DEBUG</span>
                    <span class="n">debug</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Action : Shift and goto state </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="c1">#--! DEBUG</span>

                    <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="c1"># Decrease error count on successful shift</span>
                    <span class="k">if</span> <span class="n">errorcount</span><span class="p">:</span>
                        <span class="n">errorcount</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># reduce a symbol on the stack, emit a production</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">prod</span><span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>
                    <span class="n">pname</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">plen</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span>

                    <span class="c1"># Get production function</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                    <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">pname</span>       <span class="c1"># Production name</span>
                    <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="c1">#--! DEBUG</span>
                    <span class="k">if</span> <span class="n">plen</span><span class="p">:</span>
                        <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Action : Reduce rule [</span><span class="si">%s</span><span class="s1">] with </span><span class="si">%s</span><span class="s1"> and goto state </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">str</span><span class="p">,</span>
                                   <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">format_stack_entry</span><span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">,</span>
                                   <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">plen</span><span class="p">]][</span><span class="n">pname</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Action : Reduce rule [</span><span class="si">%s</span><span class="s1">] with </span><span class="si">%s</span><span class="s1"> and goto state </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="p">[],</span>
                                   <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">])</span>

                    <span class="c1">#--! DEBUG</span>

                    <span class="k">if</span> <span class="n">plen</span><span class="p">:</span>
                        <span class="n">targ</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">targ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sym</span>

                        <span class="c1">#--! TRACKING</span>
                        <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                            <span class="n">t1</span> <span class="o">=</span> <span class="n">targ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">lexpos</span>
                            <span class="n">t1</span> <span class="o">=</span> <span class="n">targ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="s1">&#39;endlineno&#39;</span><span class="p">,</span> <span class="n">t1</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="s1">&#39;endlexpos&#39;</span><span class="p">,</span> <span class="n">t1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
                        <span class="c1">#--! TRACKING</span>

                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
                        <span class="c1"># The code enclosed in this section is duplicated</span>
                        <span class="c1"># below as a performance optimization.  Make sure</span>
                        <span class="c1"># changes get made in both locations.</span>

                        <span class="n">pslice</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">targ</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Call the grammar rule with our special slice object</span>
                            <span class="k">del</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">pslice</span><span class="p">)</span>
                            <span class="k">del</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]</span>
                            <span class="c1">#--! DEBUG</span>
                            <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Result : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">format_result</span><span class="p">(</span><span class="n">pslice</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="c1">#--! DEBUG</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">]</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                            <span class="c1"># If an error was set. Enter error recovery state</span>
                            <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>    <span class="c1"># Save the current lookahead token</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">targ</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>         <span class="c1"># Put the production slice back on the stack</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>                    <span class="c1"># Pop back one state (before the reduce)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">sym</span>
                            <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">continue</span>
                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="c1">#--! TRACKING</span>
                        <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lexpos</span>
                        <span class="c1">#--! TRACKING</span>

                        <span class="n">targ</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym</span><span class="p">]</span>

                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
                        <span class="c1"># The code enclosed in this section is duplicated</span>
                        <span class="c1"># above as a performance optimization.  Make sure</span>
                        <span class="c1"># changes get made in both locations.</span>

                        <span class="n">pslice</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">targ</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Call the grammar rule with our special slice object</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">pslice</span><span class="p">)</span>
                            <span class="c1">#--! DEBUG</span>
                            <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Result : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">format_result</span><span class="p">(</span><span class="n">pslice</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="c1">#--! DEBUG</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">]</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                            <span class="c1"># If an error was set. Enter error recovery state</span>
                            <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>    <span class="c1"># Save the current lookahead token</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>                    <span class="c1"># Pop back one state (before the reduce)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">sym</span>
                            <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">continue</span>
                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="c1">#--! DEBUG</span>
                    <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Done   : Returning </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">format_result</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                    <span class="n">debug</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PLY: PARSE DEBUG END&#39;</span><span class="p">)</span>
                    <span class="c1">#--! DEBUG</span>
                    <span class="k">return</span> <span class="n">result</span>

            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1">#--! DEBUG</span>
                <span class="n">debug</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error  : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> . </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">xx</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">symstack</span><span class="p">][</span><span class="mi">1</span><span class="p">:]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)))</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
                <span class="c1">#--! DEBUG</span>

                <span class="c1"># We have some kind of parsing error here.  To handle</span>
                <span class="c1"># this, we are going to push the current token onto</span>
                <span class="c1"># the tokenstack and replace it with an &#39;error&#39; token.</span>
                <span class="c1"># If there are any synchronization rules, they may</span>
                <span class="c1"># catch it.</span>
                <span class="c1">#</span>
                <span class="c1"># In addition to pushing the error token, we call call</span>
                <span class="c1"># the user defined p_error() function if this is the</span>
                <span class="c1"># first syntax error.  This function is only called if</span>
                <span class="c1"># errorcount == 0.</span>
                <span class="k">if</span> <span class="n">errorcount</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span><span class="p">:</span>
                    <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">errtoken</span> <span class="o">=</span> <span class="n">lookahead</span>
                    <span class="k">if</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                        <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># End of file!</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">errtoken</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">errtoken</span><span class="p">,</span> <span class="s1">&#39;lexer&#39;</span><span class="p">):</span>
                            <span class="n">errtoken</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                        <span class="n">tok</span> <span class="o">=</span> <span class="n">call_errorfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span><span class="p">,</span> <span class="n">errtoken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span><span class="p">:</span>
                            <span class="c1"># User must have done some kind of panic</span>
                            <span class="c1"># mode recovery on their own.  The</span>
                            <span class="c1"># returned token is the next lookahead</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">tok</span>
                            <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">errtoken</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">errtoken</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">):</span>
                                <span class="n">lineno</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="n">lineno</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Syntax error at line </span><span class="si">%d</span><span class="s1">, token=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Syntax error, token=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Parse error in input. EOF</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="k">return</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>

                <span class="c1"># case 1:  the statestack only has 1 entry on it.  If we&#39;re in this state, the</span>
                <span class="c1"># entire parse has been rolled back and we&#39;re completely hosed.   The token is</span>
                <span class="c1"># discarded and we just keep going.</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statestack</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># Nuke the pushback stack</span>
                    <span class="k">del</span> <span class="n">lookaheadstack</span><span class="p">[:]</span>
                    <span class="k">continue</span>

                <span class="c1"># case 2: the statestack has a couple of entries on it, but we&#39;re</span>
                <span class="c1"># at the end of the file. nuke the top entry and generate an error token</span>

                <span class="c1"># Start nuking entries on the stack</span>
                <span class="k">if</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                    <span class="c1"># Whoa. We&#39;re really hosed here. Bail out</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                        <span class="c1"># Hmmm. Error is on top of stack, we&#39;ll just nuke input</span>
                        <span class="c1"># symbol and continue</span>
                        <span class="c1">#--! TRACKING</span>
                        <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
                        <span class="c1">#--! TRACKING</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">continue</span>

                    <span class="c1"># Create the error symbol for the first time and make it the new lookahead symbol</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">):</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">):</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lexpos</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">lookahead</span>
                    <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="n">t</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">symstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="c1">#--! TRACKING</span>
                    <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span>
                    <span class="c1">#--! TRACKING</span>
                    <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">continue</span>

            <span class="c1"># Call an error function here</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;yacc: internal parser error!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

        <span class="c1">#--! parsedebug-end</span>

    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
    <span class="c1"># parseopt().</span>
    <span class="c1">#</span>
    <span class="c1"># Optimized version of parse() method.  DO NOT EDIT THIS CODE DIRECTLY!</span>
    <span class="c1"># This code is automatically generated by the ply/ygen.py script. Make</span>
    <span class="c1"># changes to the parsedebug() method instead.</span>
    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

<div class="viewcode-block" id="LRParser.parseopt"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.parseopt">[docs]</a>    <span class="k">def</span> <span class="nf">parseopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tracking</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#--! parseopt-start</span>
        <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>                         <span class="c1"># Current lookahead symbol</span>
        <span class="n">lookaheadstack</span> <span class="o">=</span> <span class="p">[]</span>                      <span class="c1"># Stack of lookahead symbols</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span>                    <span class="c1"># Local reference to action table (to avoid lookup on self.)</span>
        <span class="n">goto</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto</span>                      <span class="c1"># Local reference to goto table (to avoid lookup on self.)</span>
        <span class="n">prod</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span>               <span class="c1"># Local reference to production list (to avoid lookup on self.)</span>
        <span class="n">defaulted_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaulted_states</span> <span class="c1"># Local reference to defaulted states</span>
        <span class="n">pslice</span>  <span class="o">=</span> <span class="n">YaccProduction</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>           <span class="c1"># Production object passed to grammar rules</span>
        <span class="n">errorcount</span> <span class="o">=</span> <span class="mi">0</span>                           <span class="c1"># Used during error recovery</span>


        <span class="c1"># If no lexer was given, we will try to use the lex module</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lexer</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">lex</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">lexer</span>

        <span class="c1"># Set up the lexer and parser objects on pslice</span>
        <span class="n">pslice</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
        <span class="n">pslice</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># If input was supplied, pass to lexer</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lexer</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tokenfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Tokenize function</span>
            <span class="n">get_token</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">token</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_token</span> <span class="o">=</span> <span class="n">tokenfunc</span>

        <span class="c1"># Set the parser() token method (sometimes used in error recovery)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">get_token</span>

        <span class="c1"># Set up the state and symbol stacks</span>

        <span class="n">statestack</span> <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># Stack of parsing states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statestack</span> <span class="o">=</span> <span class="n">statestack</span>
        <span class="n">symstack</span>   <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># Stack of grammar symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symstack</span> <span class="o">=</span> <span class="n">symstack</span>

        <span class="n">pslice</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">symstack</span>         <span class="c1"># Put in the production</span>
        <span class="n">errtoken</span>   <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># Err token</span>

        <span class="c1"># The start state is assumed to be (0,$end)</span>

        <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>
        <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Get the next symbol on the input.  If a lookahead symbol</span>
            <span class="c1"># is already set, we just use that. Otherwise, we&#39;ll pull</span>
            <span class="c1"># the next token off of the lookaheadstack or from the lexer</span>


            <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaulted_states</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lookahead</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">lookaheadstack</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">()</span>     <span class="c1"># Get the next token</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">lookahead</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>

                <span class="c1"># Check the action table</span>
                <span class="n">ltype</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">state</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ltype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">defaulted_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>


            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># shift a symbol on the stack</span>
                    <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">t</span>


                    <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="c1"># Decrease error count on successful shift</span>
                    <span class="k">if</span> <span class="n">errorcount</span><span class="p">:</span>
                        <span class="n">errorcount</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># reduce a symbol on the stack, emit a production</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">prod</span><span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>
                    <span class="n">pname</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">plen</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span>

                    <span class="c1"># Get production function</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                    <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">pname</span>       <span class="c1"># Production name</span>
                    <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>


                    <span class="k">if</span> <span class="n">plen</span><span class="p">:</span>
                        <span class="n">targ</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">targ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sym</span>

                        <span class="c1">#--! TRACKING</span>
                        <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                            <span class="n">t1</span> <span class="o">=</span> <span class="n">targ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">lexpos</span>
                            <span class="n">t1</span> <span class="o">=</span> <span class="n">targ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="s1">&#39;endlineno&#39;</span><span class="p">,</span> <span class="n">t1</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="s1">&#39;endlexpos&#39;</span><span class="p">,</span> <span class="n">t1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
                        <span class="c1">#--! TRACKING</span>

                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
                        <span class="c1"># The code enclosed in this section is duplicated</span>
                        <span class="c1"># below as a performance optimization.  Make sure</span>
                        <span class="c1"># changes get made in both locations.</span>

                        <span class="n">pslice</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">targ</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Call the grammar rule with our special slice object</span>
                            <span class="k">del</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">pslice</span><span class="p">)</span>
                            <span class="k">del</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">]</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                            <span class="c1"># If an error was set. Enter error recovery state</span>
                            <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>    <span class="c1"># Save the current lookahead token</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">targ</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>         <span class="c1"># Put the production slice back on the stack</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>                    <span class="c1"># Pop back one state (before the reduce)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">sym</span>
                            <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">continue</span>
                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="c1">#--! TRACKING</span>
                        <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lexpos</span>
                        <span class="c1">#--! TRACKING</span>

                        <span class="n">targ</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym</span><span class="p">]</span>

                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
                        <span class="c1"># The code enclosed in this section is duplicated</span>
                        <span class="c1"># above as a performance optimization.  Make sure</span>
                        <span class="c1"># changes get made in both locations.</span>

                        <span class="n">pslice</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">targ</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Call the grammar rule with our special slice object</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">pslice</span><span class="p">)</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">]</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                            <span class="c1"># If an error was set. Enter error recovery state</span>
                            <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>    <span class="c1"># Save the current lookahead token</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>                    <span class="c1"># Pop back one state (before the reduce)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">sym</span>
                            <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">continue</span>
                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">result</span>

            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>


                <span class="c1"># We have some kind of parsing error here.  To handle</span>
                <span class="c1"># this, we are going to push the current token onto</span>
                <span class="c1"># the tokenstack and replace it with an &#39;error&#39; token.</span>
                <span class="c1"># If there are any synchronization rules, they may</span>
                <span class="c1"># catch it.</span>
                <span class="c1">#</span>
                <span class="c1"># In addition to pushing the error token, we call call</span>
                <span class="c1"># the user defined p_error() function if this is the</span>
                <span class="c1"># first syntax error.  This function is only called if</span>
                <span class="c1"># errorcount == 0.</span>
                <span class="k">if</span> <span class="n">errorcount</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span><span class="p">:</span>
                    <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">errtoken</span> <span class="o">=</span> <span class="n">lookahead</span>
                    <span class="k">if</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                        <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># End of file!</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">errtoken</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">errtoken</span><span class="p">,</span> <span class="s1">&#39;lexer&#39;</span><span class="p">):</span>
                            <span class="n">errtoken</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                        <span class="n">tok</span> <span class="o">=</span> <span class="n">call_errorfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span><span class="p">,</span> <span class="n">errtoken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span><span class="p">:</span>
                            <span class="c1"># User must have done some kind of panic</span>
                            <span class="c1"># mode recovery on their own.  The</span>
                            <span class="c1"># returned token is the next lookahead</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">tok</span>
                            <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">errtoken</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">errtoken</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">):</span>
                                <span class="n">lineno</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="n">lineno</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Syntax error at line </span><span class="si">%d</span><span class="s1">, token=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Syntax error, token=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Parse error in input. EOF</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="k">return</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>

                <span class="c1"># case 1:  the statestack only has 1 entry on it.  If we&#39;re in this state, the</span>
                <span class="c1"># entire parse has been rolled back and we&#39;re completely hosed.   The token is</span>
                <span class="c1"># discarded and we just keep going.</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statestack</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># Nuke the pushback stack</span>
                    <span class="k">del</span> <span class="n">lookaheadstack</span><span class="p">[:]</span>
                    <span class="k">continue</span>

                <span class="c1"># case 2: the statestack has a couple of entries on it, but we&#39;re</span>
                <span class="c1"># at the end of the file. nuke the top entry and generate an error token</span>

                <span class="c1"># Start nuking entries on the stack</span>
                <span class="k">if</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                    <span class="c1"># Whoa. We&#39;re really hosed here. Bail out</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                        <span class="c1"># Hmmm. Error is on top of stack, we&#39;ll just nuke input</span>
                        <span class="c1"># symbol and continue</span>
                        <span class="c1">#--! TRACKING</span>
                        <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
                        <span class="c1">#--! TRACKING</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">continue</span>

                    <span class="c1"># Create the error symbol for the first time and make it the new lookahead symbol</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">):</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">):</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lexpos</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">lookahead</span>
                    <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="n">t</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">symstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="c1">#--! TRACKING</span>
                    <span class="k">if</span> <span class="n">tracking</span><span class="p">:</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">lineno</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">lexpos</span>
                    <span class="c1">#--! TRACKING</span>
                    <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">continue</span>

            <span class="c1"># Call an error function here</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;yacc: internal parser error!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

        <span class="c1">#--! parseopt-end</span>

    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
    <span class="c1"># parseopt_notrack().</span>
    <span class="c1">#</span>
    <span class="c1"># Optimized version of parseopt() with line number tracking removed.</span>
    <span class="c1"># DO NOT EDIT THIS CODE DIRECTLY. This code is automatically generated</span>
    <span class="c1"># by the ply/ygen.py script. Make changes to the parsedebug() method instead.</span>
    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

<div class="viewcode-block" id="LRParser.parseopt_notrack"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRParser.parseopt_notrack">[docs]</a>    <span class="k">def</span> <span class="nf">parseopt_notrack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tracking</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tokenfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#--! parseopt-notrack-start</span>
        <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>                         <span class="c1"># Current lookahead symbol</span>
        <span class="n">lookaheadstack</span> <span class="o">=</span> <span class="p">[]</span>                      <span class="c1"># Stack of lookahead symbols</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span>                    <span class="c1"># Local reference to action table (to avoid lookup on self.)</span>
        <span class="n">goto</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto</span>                      <span class="c1"># Local reference to goto table (to avoid lookup on self.)</span>
        <span class="n">prod</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span>               <span class="c1"># Local reference to production list (to avoid lookup on self.)</span>
        <span class="n">defaulted_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaulted_states</span> <span class="c1"># Local reference to defaulted states</span>
        <span class="n">pslice</span>  <span class="o">=</span> <span class="n">YaccProduction</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>           <span class="c1"># Production object passed to grammar rules</span>
        <span class="n">errorcount</span> <span class="o">=</span> <span class="mi">0</span>                           <span class="c1"># Used during error recovery</span>


        <span class="c1"># If no lexer was given, we will try to use the lex module</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lexer</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">lex</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">lexer</span>

        <span class="c1"># Set up the lexer and parser objects on pslice</span>
        <span class="n">pslice</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
        <span class="n">pslice</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># If input was supplied, pass to lexer</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lexer</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tokenfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Tokenize function</span>
            <span class="n">get_token</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">token</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_token</span> <span class="o">=</span> <span class="n">tokenfunc</span>

        <span class="c1"># Set the parser() token method (sometimes used in error recovery)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">get_token</span>

        <span class="c1"># Set up the state and symbol stacks</span>

        <span class="n">statestack</span> <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># Stack of parsing states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statestack</span> <span class="o">=</span> <span class="n">statestack</span>
        <span class="n">symstack</span>   <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># Stack of grammar symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symstack</span> <span class="o">=</span> <span class="n">symstack</span>

        <span class="n">pslice</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">symstack</span>         <span class="c1"># Put in the production</span>
        <span class="n">errtoken</span>   <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># Err token</span>

        <span class="c1"># The start state is assumed to be (0,$end)</span>

        <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>
        <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Get the next symbol on the input.  If a lookahead symbol</span>
            <span class="c1"># is already set, we just use that. Otherwise, we&#39;ll pull</span>
            <span class="c1"># the next token off of the lookaheadstack or from the lexer</span>


            <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaulted_states</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lookahead</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">lookaheadstack</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">()</span>     <span class="c1"># Get the next token</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">lookahead</span><span class="p">:</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                        <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;$end&#39;</span>

                <span class="c1"># Check the action table</span>
                <span class="n">ltype</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">state</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ltype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">defaulted_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>


            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># shift a symbol on the stack</span>
                    <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">t</span>


                    <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="c1"># Decrease error count on successful shift</span>
                    <span class="k">if</span> <span class="n">errorcount</span><span class="p">:</span>
                        <span class="n">errorcount</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># reduce a symbol on the stack, emit a production</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">prod</span><span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>
                    <span class="n">pname</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">plen</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span>

                    <span class="c1"># Get production function</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                    <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">pname</span>       <span class="c1"># Production name</span>
                    <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>


                    <span class="k">if</span> <span class="n">plen</span><span class="p">:</span>
                        <span class="n">targ</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">targ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sym</span>


                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
                        <span class="c1"># The code enclosed in this section is duplicated</span>
                        <span class="c1"># below as a performance optimization.  Make sure</span>
                        <span class="c1"># changes get made in both locations.</span>

                        <span class="n">pslice</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">targ</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Call the grammar rule with our special slice object</span>
                            <span class="k">del</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">pslice</span><span class="p">)</span>
                            <span class="k">del</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="n">plen</span><span class="p">:]</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">]</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                            <span class="c1"># If an error was set. Enter error recovery state</span>
                            <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>    <span class="c1"># Save the current lookahead token</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">targ</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>         <span class="c1"># Put the production slice back on the stack</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>                    <span class="c1"># Pop back one state (before the reduce)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">sym</span>
                            <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">continue</span>
                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

                    <span class="k">else</span><span class="p">:</span>


                        <span class="n">targ</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym</span><span class="p">]</span>

                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
                        <span class="c1"># The code enclosed in this section is duplicated</span>
                        <span class="c1"># above as a performance optimization.  Make sure</span>
                        <span class="c1"># changes get made in both locations.</span>

                        <span class="n">pslice</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">targ</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Call the grammar rule with our special slice object</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">pslice</span><span class="p">)</span>
                            <span class="n">symstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">pname</span><span class="p">]</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                            <span class="c1"># If an error was set. Enter error recovery state</span>
                            <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>    <span class="c1"># Save the current lookahead token</span>
                            <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>                    <span class="c1"># Pop back one state (before the reduce)</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">sym</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">sym</span>
                            <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">continue</span>
                        <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>

                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">result</span>

            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>


                <span class="c1"># We have some kind of parsing error here.  To handle</span>
                <span class="c1"># this, we are going to push the current token onto</span>
                <span class="c1"># the tokenstack and replace it with an &#39;error&#39; token.</span>
                <span class="c1"># If there are any synchronization rules, they may</span>
                <span class="c1"># catch it.</span>
                <span class="c1">#</span>
                <span class="c1"># In addition to pushing the error token, we call call</span>
                <span class="c1"># the user defined p_error() function if this is the</span>
                <span class="c1"># first syntax error.  This function is only called if</span>
                <span class="c1"># errorcount == 0.</span>
                <span class="k">if</span> <span class="n">errorcount</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span><span class="p">:</span>
                    <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">errtoken</span> <span class="o">=</span> <span class="n">lookahead</span>
                    <span class="k">if</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                        <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># End of file!</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">errtoken</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">errtoken</span><span class="p">,</span> <span class="s1">&#39;lexer&#39;</span><span class="p">):</span>
                            <span class="n">errtoken</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                        <span class="n">tok</span> <span class="o">=</span> <span class="n">call_errorfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorfunc</span><span class="p">,</span> <span class="n">errtoken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorok</span><span class="p">:</span>
                            <span class="c1"># User must have done some kind of panic</span>
                            <span class="c1"># mode recovery on their own.  The</span>
                            <span class="c1"># returned token is the next lookahead</span>
                            <span class="n">lookahead</span> <span class="o">=</span> <span class="n">tok</span>
                            <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">errtoken</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">errtoken</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">):</span>
                                <span class="n">lineno</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="n">lineno</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Syntax error at line </span><span class="si">%d</span><span class="s1">, token=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Syntax error, token=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">errtoken</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;yacc: Parse error in input. EOF</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="k">return</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errorcount</span> <span class="o">=</span> <span class="n">error_count</span>

                <span class="c1"># case 1:  the statestack only has 1 entry on it.  If we&#39;re in this state, the</span>
                <span class="c1"># entire parse has been rolled back and we&#39;re completely hosed.   The token is</span>
                <span class="c1"># discarded and we just keep going.</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statestack</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">errtoken</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># Nuke the pushback stack</span>
                    <span class="k">del</span> <span class="n">lookaheadstack</span><span class="p">[:]</span>
                    <span class="k">continue</span>

                <span class="c1"># case 2: the statestack has a couple of entries on it, but we&#39;re</span>
                <span class="c1"># at the end of the file. nuke the top entry and generate an error token</span>

                <span class="c1"># Start nuking entries on the stack</span>
                <span class="k">if</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;$end&#39;</span><span class="p">:</span>
                    <span class="c1"># Whoa. We&#39;re really hosed here. Bail out</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">symstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                        <span class="c1"># Hmmm. Error is on top of stack, we&#39;ll just nuke input</span>
                        <span class="c1"># symbol and continue</span>
                        <span class="n">lookahead</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">continue</span>

                    <span class="c1"># Create the error symbol for the first time and make it the new lookahead symbol</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">YaccSymbol</span><span class="p">()</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">):</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">endlineno</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lineno</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookahead</span><span class="p">,</span> <span class="s1">&#39;lexpos&#39;</span><span class="p">):</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">endlexpos</span> <span class="o">=</span> <span class="n">lookahead</span><span class="o">.</span><span class="n">lexpos</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">lookahead</span>
                    <span class="n">lookaheadstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead</span><span class="p">)</span>
                    <span class="n">lookahead</span> <span class="o">=</span> <span class="n">t</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">symstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">statestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">statestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">continue</span>

            <span class="c1"># Call an error function here</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;yacc: internal parser error!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

        <span class="c1">#--! parseopt-notrack-end</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                          === Grammar Representation ===</span>
<span class="c1">#</span>
<span class="c1"># The following functions, classes, and variables are used to represent and</span>
<span class="c1"># manipulate the rules that make up a grammar.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># regex matching identifiers</span>
<span class="n">_is_identifier</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9_-]+$&#39;</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># class Production:</span>
<span class="c1">#</span>
<span class="c1"># This class stores the raw information about a single production or grammar rule.</span>
<span class="c1"># A grammar rule refers to a specification such as this:</span>
<span class="c1">#</span>
<span class="c1">#       expr : expr PLUS term</span>
<span class="c1">#</span>
<span class="c1"># Here are the basic attributes defined on all productions</span>
<span class="c1">#</span>
<span class="c1">#       name     - Name of the production.  For example &#39;expr&#39;</span>
<span class="c1">#       prod     - A list of symbols on the right side [&#39;expr&#39;,&#39;PLUS&#39;,&#39;term&#39;]</span>
<span class="c1">#       prec     - Production precedence level</span>
<span class="c1">#       number   - Production number.</span>
<span class="c1">#       func     - Function that executes on reduce</span>
<span class="c1">#       file     - File where production function is defined</span>
<span class="c1">#       lineno   - Line number where production function is defined</span>
<span class="c1">#</span>
<span class="c1"># The following attributes are defined or optional.</span>
<span class="c1">#</span>
<span class="c1">#       len       - Length of the production (number of symbols on right hand side)</span>
<span class="c1">#       usyms     - Set of unique symbols found in the production</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Production"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Production">[docs]</a><span class="k">class</span> <span class="nc">Production</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">reduced</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">prod</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>     <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prod</span>     <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span>   <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span>     <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callable</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span>     <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span>     <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prec</span>     <span class="o">=</span> <span class="n">precedence</span>

        <span class="c1"># Internal settings used during table construction</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">len</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>   <span class="c1"># Length of the production</span>

        <span class="c1"># Create a list of unique production symbols used in the production</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usyms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usyms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usyms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># List of all LR items for the production</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_next</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Create a string representation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -&gt; &lt;empty&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Production(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># Return the nth lr_item from the production (or None if at the end)</span>
<div class="viewcode-block" id="Production.lr_item"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Production.lr_item">[docs]</a>    <span class="k">def</span> <span class="nf">lr_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">LRItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="c1"># Precompute the list of productions immediately following.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lr_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lr_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lr_before</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lr_before</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">p</span></div>

    <span class="c1"># Bind the production function name to a callable</span>
<div class="viewcode-block" id="Production.bind"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Production.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callable</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">]</span></div></div>

<span class="c1"># This class serves as a minimal standin for Production objects when</span>
<span class="c1"># reading table data from files.   It only contains information</span>
<span class="c1"># actually used by the LR parsing engine, plus some additional</span>
<span class="c1"># debugging information.</span>
<div class="viewcode-block" id="MiniProduction"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.MiniProduction">[docs]</a><span class="k">class</span> <span class="nc">MiniProduction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>     <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len</span>      <span class="o">=</span> <span class="nb">len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span>     <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callable</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span>     <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span>     <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str</span>      <span class="o">=</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;MiniProduction(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span>

    <span class="c1"># Bind the production function name to a callable</span>
<div class="viewcode-block" id="MiniProduction.bind"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.MiniProduction.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callable</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">]</span></div></div>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># class LRItem</span>
<span class="c1">#</span>
<span class="c1"># This class represents a specific stage of parsing a production rule.  For</span>
<span class="c1"># example:</span>
<span class="c1">#</span>
<span class="c1">#       expr : expr . PLUS term</span>
<span class="c1">#</span>
<span class="c1"># In the above, the &quot;.&quot; represents the current location of the parse.  Here</span>
<span class="c1"># basic attributes:</span>
<span class="c1">#</span>
<span class="c1">#       name       - Name of the production.  For example &#39;expr&#39;</span>
<span class="c1">#       prod       - A list of symbols on the right side [&#39;expr&#39;,&#39;.&#39;, &#39;PLUS&#39;,&#39;term&#39;]</span>
<span class="c1">#       number     - Production number.</span>
<span class="c1">#</span>
<span class="c1">#       lr_next      Next LR item. Example, if we are &#39; expr -&gt; expr . PLUS term&#39;</span>
<span class="c1">#                    then lr_next refers to &#39;expr -&gt; expr PLUS . term&#39;</span>
<span class="c1">#       lr_index   - LR item index (location of the &quot;.&quot;) in the prod list.</span>
<span class="c1">#       lookaheads - LALR lookahead symbols for this item</span>
<span class="c1">#       len        - Length of the production (number of symbols on right hand side)</span>
<span class="c1">#       lr_after    - List of all productions that immediately follow</span>
<span class="c1">#       lr_before   - Grammar symbol immediately before</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRItem"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRItem">[docs]</a><span class="k">class</span> <span class="nc">LRItem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prod</span>       <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span>     <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_index</span>   <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookaheads</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prod</span>       <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len</span>        <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usyms</span>      <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">usyms</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -&gt; &lt;empty&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;LRItem(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># rightmost_terminal()</span>
<span class="c1">#</span>
<span class="c1"># Return the rightmost terminal from a list of symbols.  Used in add_production()</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="rightmost_terminal"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.rightmost_terminal">[docs]</a><span class="k">def</span> <span class="nf">rightmost_terminal</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">terminals</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                           === GRAMMAR CLASS ===</span>
<span class="c1">#</span>
<span class="c1"># The following class represents the contents of the specified grammar along</span>
<span class="c1"># with various computed properties such as first sets, follow sets, LR items, etc.</span>
<span class="c1"># This data is used for critical parts of the table generation process later.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="GrammarError"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.GrammarError">[docs]</a><span class="k">class</span> <span class="nc">GrammarError</span><span class="p">(</span><span class="n">YaccError</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Grammar"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar">[docs]</a><span class="k">class</span> <span class="nc">Grammar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terminals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span>  <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>  <span class="c1"># A list of all of the productions.  The first</span>
                                    <span class="c1"># entry is always reserved for the purpose of</span>
                                    <span class="c1"># building an augmented grammar</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span>    <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># A dictionary mapping the names of nonterminals to a list of all</span>
                                    <span class="c1"># productions of that nonterminal.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Prodmap</span>      <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># A dictionary that is only used to detect duplicate</span>
                                    <span class="c1"># productions.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span>    <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># A dictionary mapping the names of terminal symbols to a</span>
                                    <span class="c1"># list of the rules where they are used.</span>

        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span> <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># A dictionary mapping names of nonterminals to a list</span>
                                    <span class="c1"># of rule numbers where they are used.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">First</span>        <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># A dictionary of precomputed FIRST(x) symbols</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span>       <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># A dictionary of precomputed FOLLOW(x) symbols</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span>   <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># Precedence rules for each terminal. Contains tuples of the</span>
                                    <span class="c1"># form (&#39;right&#39;,level) or (&#39;nonassoc&#39;, level) or (&#39;left&#39;,level)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UsedPrecedence</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1"># Precedence rules that were actually used by the grammer.</span>
                                    <span class="c1"># This is only used to provide error checking and to generate</span>
                                    <span class="c1"># a warning about unused precedence rules.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Start</span> <span class="o">=</span> <span class="kc">None</span>           <span class="c1"># Starting symbol for the grammar</span>


    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># set_precedence()</span>
    <span class="c1">#</span>
    <span class="c1"># Sets the precedence for a given terminal. assoc is the associativity such as</span>
    <span class="c1"># &#39;left&#39;,&#39;right&#39;, or &#39;nonassoc&#39;.  level is a numeric level.</span>
    <span class="c1">#</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.set_precedence"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.set_precedence">[docs]</a>    <span class="k">def</span> <span class="nf">set_precedence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;Must call set_precedence() before add_production()&#39;</span>
        <span class="k">if</span> <span class="n">term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;Precedence already specified for terminal </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">term</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">assoc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;nonassoc&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s2">&quot;Associativity must be one of &#39;left&#39;,&#39;right&#39;, or &#39;nonassoc&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">assoc</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># add_production()</span>
    <span class="c1">#</span>
    <span class="c1"># Given an action function, this function assembles a production rule and</span>
    <span class="c1"># computes its precedence level.</span>
    <span class="c1">#</span>
    <span class="c1"># The production rule is supplied as a list of symbols.   For example,</span>
    <span class="c1"># a rule such as &#39;expr : expr PLUS term&#39; has a production name of &#39;expr&#39; and</span>
    <span class="c1"># symbols [&#39;expr&#39;,&#39;PLUS&#39;,&#39;term&#39;].</span>
    <span class="c1">#</span>
    <span class="c1"># Precedence is determined by the precedence of the right-most non-terminal</span>
    <span class="c1"># or the precedence of a terminal specified by %prec.</span>
    <span class="c1">#</span>
    <span class="c1"># A variety of error checks are performed to make sure production symbols</span>
    <span class="c1"># are valid and that %prec is used correctly.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.add_production"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.add_production">[docs]</a>    <span class="k">def</span> <span class="nf">add_production</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodname</span><span class="p">,</span> <span class="n">syms</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">prodname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Illegal rule name </span><span class="si">%r</span><span class="s1">. Already defined as a token&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">prodname</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">prodname</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Illegal rule name </span><span class="si">%r</span><span class="s1">. error is a reserved word&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">prodname</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_identifier</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">prodname</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Illegal rule name </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">prodname</span><span class="p">))</span>

        <span class="c1"># Look for literal tokens</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;&#39;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Literal token </span><span class="si">%s</span><span class="s1"> in rule </span><span class="si">%r</span><span class="s1"> may only be a single character&#39;</span> <span class="o">%</span>
                                           <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prodname</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">syms</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_identifier</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="s1">&#39;%prec&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Illegal name </span><span class="si">%r</span><span class="s1"> in rule </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prodname</span><span class="p">))</span>

        <span class="c1"># Determine the precedence level</span>
        <span class="k">if</span> <span class="s1">&#39;%prec&#39;</span> <span class="ow">in</span> <span class="n">syms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">syms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;%prec&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Syntax error. Nothing follows </span><span class="si">%%</span><span class="s1">prec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">syms</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;%prec&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Syntax error. </span><span class="si">%%</span><span class="s1">prec can only appear at the end of a grammar rule&#39;</span> <span class="o">%</span>
                                   <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="n">precname</span> <span class="o">=</span> <span class="n">syms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">prodprec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">precname</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prodprec</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Nothing known about the precedence of </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">precname</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UsedPrecedence</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">precname</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">syms</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>     <span class="c1"># Drop %prec from the rule</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no %prec, precedence is determined by the rightmost terminal symbol</span>
            <span class="n">precname</span> <span class="o">=</span> <span class="n">rightmost_terminal</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">)</span>
            <span class="n">prodprec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">precname</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># See if the rule is already in the rulemap</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prodname</span><span class="p">,</span> <span class="n">syms</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodmap</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodmap</span><span class="p">[</span><span class="nb">map</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Duplicate rule </span><span class="si">%s</span><span class="s1">. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span>
                               <span class="s1">&#39;Previous definition at </span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">line</span><span class="p">))</span>

        <span class="c1"># From this point on, everything is valid.  Create a new Production instance</span>
        <span class="n">pnumber</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prodname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">[</span><span class="n">prodname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add the production number to Terminals and Nonterminals</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">syms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pnumber</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pnumber</span><span class="p">)</span>

        <span class="c1"># Create a production and add it to the list of productions</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Production</span><span class="p">(</span><span class="n">pnumber</span><span class="p">,</span> <span class="n">prodname</span><span class="p">,</span> <span class="n">syms</span><span class="p">,</span> <span class="n">prodprec</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Prodmap</span><span class="p">[</span><span class="nb">map</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="c1"># Add to the global productions list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="p">[</span><span class="n">prodname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="p">[</span><span class="n">prodname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># set_start()</span>
    <span class="c1">#</span>
    <span class="c1"># Sets the starting symbol and creates the augmented grammar.  Production</span>
    <span class="c1"># rule 0 is S&#39; -&gt; start where start is the start symbol.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.set_start"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.set_start">[docs]</a>    <span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GrammarError</span><span class="p">(</span><span class="s1">&#39;start symbol </span><span class="si">%s</span><span class="s1"> undefined&#39;</span> <span class="o">%</span> <span class="n">start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Production</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;S&#39;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">start</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Start</span> <span class="o">=</span> <span class="n">start</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># find_unreachable()</span>
    <span class="c1">#</span>
    <span class="c1"># Find all of the nonterminal symbols that can&#39;t be reached from the starting</span>
    <span class="c1"># symbol.  Returns a list of nonterminals that can&#39;t be reached.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.find_unreachable"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.find_unreachable">[docs]</a>    <span class="k">def</span> <span class="nf">find_unreachable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Mark all symbols that are reachable from a symbol s</span>
        <span class="k">def</span> <span class="nf">mark_reachable_from</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">reachable</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
                    <span class="n">mark_reachable_from</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="n">reachable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">mark_reachable_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reachable</span><span class="p">]</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># infinite_cycles()</span>
    <span class="c1">#</span>
    <span class="c1"># This function looks at the various parsing rules and tries to detect</span>
    <span class="c1"># infinite recursion cycles (grammar rules where there is no possible way</span>
    <span class="c1"># to derive a string of only terminals).</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.infinite_cycles"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.infinite_cycles">[docs]</a>    <span class="k">def</span> <span class="nf">infinite_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">terminates</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Terminals:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
            <span class="n">terminates</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">terminates</span><span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Nonterminals:</span>

        <span class="c1"># Initialize to false:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
            <span class="n">terminates</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Then propagate termination until no change:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">some_change</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Nonterminal n terminates iff any of its productions terminates.</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pl</span><span class="p">:</span>
                    <span class="c1"># Production p terminates iff all of its rhs symbols terminate.</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">terminates</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                            <span class="c1"># The symbol s does not terminate,</span>
                            <span class="c1"># so production p does not terminate.</span>
                            <span class="n">p_terminates</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># didn&#39;t break from the loop,</span>
                        <span class="c1"># so every symbol s terminates</span>
                        <span class="c1"># so production p terminates.</span>
                        <span class="n">p_terminates</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="n">p_terminates</span><span class="p">:</span>
                        <span class="c1"># symbol n terminates!</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">terminates</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                            <span class="n">terminates</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">some_change</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="c1"># Don&#39;t need to consider any more productions for this n.</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">some_change</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">infinite</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">term</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span> <span class="ow">and</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="c1"># s is used-but-not-defined, and we&#39;ve already warned of that,</span>
                    <span class="c1"># so it would be overkill to say that it&#39;s also non-terminating.</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">infinite</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">infinite</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># undefined_symbols()</span>
    <span class="c1">#</span>
    <span class="c1"># Find all symbols that were used the grammar, but not defined as tokens or</span>
    <span class="c1"># grammar rules.  Returns a list of tuples (sym, prod) where sym in the symbol</span>
    <span class="c1"># and prod is the production where the symbol was used.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Grammar.undefined_symbols"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.undefined_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">undefined_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span> <span class="ow">and</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># unused_terminals()</span>
    <span class="c1">#</span>
    <span class="c1"># Find all terminals that were defined, but not used by the grammar.  Returns</span>
    <span class="c1"># a list of all symbols.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Grammar.unused_terminals"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.unused_terminals">[docs]</a>    <span class="k">def</span> <span class="nf">unused_terminals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unused_tok</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">unused_tok</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">unused_tok</span></div>

    <span class="c1"># ------------------------------------------------------------------------------</span>
    <span class="c1"># unused_rules()</span>
    <span class="c1">#</span>
    <span class="c1"># Find all grammar rules that were defined,  but not used (maybe not reachable)</span>
    <span class="c1"># Returns a list of productions.</span>
    <span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.unused_rules"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.unused_rules">[docs]</a>    <span class="k">def</span> <span class="nf">unused_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unused_prod</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">unused_prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unused_prod</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># unused_precedence()</span>
    <span class="c1">#</span>
    <span class="c1"># Returns a list of tuples (term,precedence) corresponding to precedence</span>
    <span class="c1"># rules that were never used by the grammar.  term is the name of the terminal</span>
    <span class="c1"># on which precedence was applied and precedence is a string such as &#39;left&#39; or</span>
    <span class="c1"># &#39;right&#39; corresponding to the type of precedence.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.unused_precedence"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.unused_precedence">[docs]</a>    <span class="k">def</span> <span class="nf">unused_precedence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unused</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">termname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">termname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span> <span class="ow">or</span> <span class="n">termname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UsedPrecedence</span><span class="p">):</span>
                <span class="n">unused</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">termname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Precedence</span><span class="p">[</span><span class="n">termname</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">unused</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># _first()</span>
    <span class="c1">#</span>
    <span class="c1"># Compute the value of FIRST1(beta) where beta is a tuple of symbols.</span>
    <span class="c1">#</span>
    <span class="c1"># During execution of compute_first1, the result may be incomplete.</span>
    <span class="c1"># Afterward (e.g., when called from compute_follow()), it will be complete.</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_first</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>

        <span class="c1"># We are computing First(x1,x2,x3,...,xn)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">beta</span><span class="p">:</span>
            <span class="n">x_produces_empty</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Add all the non-&lt;empty&gt; symbols of First[x] to the result.</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;&lt;empty&gt;&#39;</span><span class="p">:</span>
                    <span class="n">x_produces_empty</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x_produces_empty</span><span class="p">:</span>
                <span class="c1"># We have to consider the next x in beta,</span>
                <span class="c1"># i.e. stay in the loop.</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We don&#39;t have to consider any further symbols in beta.</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There was no &#39;break&#39; from the loop,</span>
            <span class="c1"># so x_produces_empty was true for all x in beta,</span>
            <span class="c1"># so beta produces empty as well.</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;empty&gt;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># compute_first()</span>
    <span class="c1">#</span>
    <span class="c1"># Compute the value of FIRST1(X) for all symbols</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Grammar.compute_first"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.compute_first">[docs]</a>    <span class="k">def</span> <span class="nf">compute_first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">First</span>

        <span class="c1"># Terminals:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span>

        <span class="c1"># Nonterminals:</span>

        <span class="c1"># Initialize to the empty set:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Then propagate symbols until no change:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">some_change</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                            <span class="n">some_change</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">some_change</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">First</span></div>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="c1"># compute_follow()</span>
    <span class="c1">#</span>
    <span class="c1"># Computes all of the follow sets for every non-terminal symbol.  The</span>
    <span class="c1"># follow set is the set of all symbols that might follow a given</span>
    <span class="c1"># non-terminal.  See the Dragon book, 2nd Ed. p. 189.</span>
    <span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Grammar.compute_follow"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.compute_follow">[docs]</a>    <span class="k">def</span> <span class="nf">compute_follow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># If already computed, return the result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span>

        <span class="c1"># If first sets not computed yet, do that first.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">First</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_first</span><span class="p">()</span>

        <span class="c1"># Add &#39;$end&#39; to the follow list of the start symbol</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">didadd</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="c1"># Here is the production set</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">B</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">B</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
                        <span class="c1"># Okay. We got a non-terminal in a production</span>
                        <span class="n">fst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="n">hasempty</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fst</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="s1">&#39;&lt;empty&gt;&#39;</span> <span class="ow">and</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">B</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                                <span class="n">didadd</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;&lt;empty&gt;&#39;</span><span class="p">:</span>
                                <span class="n">hasempty</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">hasempty</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="c1"># Add elements of follow(a) to follow(b)</span>
                            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">B</span><span class="p">]:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                                    <span class="n">didadd</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">didadd</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Follow</span></div>


    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># build_lritems()</span>
    <span class="c1">#</span>
    <span class="c1"># This function walks the list of productions and builds a complete set of the</span>
    <span class="c1"># LR items.  The LR items are stored in two ways:  First, they are uniquely</span>
    <span class="c1"># numbered and placed in the list _lritems.  Second, a linked list of LR items</span>
    <span class="c1"># is built for each production.  For example:</span>
    <span class="c1">#</span>
    <span class="c1">#   E -&gt; E PLUS E</span>
    <span class="c1">#</span>
    <span class="c1"># Creates the list</span>
    <span class="c1">#</span>
    <span class="c1">#  [E -&gt; . E PLUS E, E -&gt; E . PLUS E, E -&gt; E PLUS . E, E -&gt; E PLUS E . ]</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Grammar.build_lritems"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.Grammar.build_lritems">[docs]</a>    <span class="k">def</span> <span class="nf">build_lritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Productions</span><span class="p">:</span>
            <span class="n">lastlri</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lr_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="n">lri</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lri</span> <span class="o">=</span> <span class="n">LRItem</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="c1"># Precompute the list of productions immediately following</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">lri</span><span class="o">.</span><span class="n">lr_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Prodnames</span><span class="p">[</span><span class="n">lri</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                        <span class="n">lri</span><span class="o">.</span><span class="n">lr_after</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">lri</span><span class="o">.</span><span class="n">lr_before</span> <span class="o">=</span> <span class="n">lri</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">lri</span><span class="o">.</span><span class="n">lr_before</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">lastlri</span><span class="o">.</span><span class="n">lr_next</span> <span class="o">=</span> <span class="n">lri</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lri</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">lr_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lri</span><span class="p">)</span>
                <span class="n">lastlri</span> <span class="o">=</span> <span class="n">lri</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lr_items</span> <span class="o">=</span> <span class="n">lr_items</span></div></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                            == Class LRTable ==</span>
<span class="c1">#</span>
<span class="c1"># This basic class represents a basic table of LR parsing information.</span>
<span class="c1"># Methods for generating the tables are not defined here.  They are defined</span>
<span class="c1"># in the derived class LRGeneratedTable.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="VersionError"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.VersionError">[docs]</a><span class="k">class</span> <span class="nc">VersionError</span><span class="p">(</span><span class="n">YaccError</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="LRTable"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRTable">[docs]</a><span class="k">class</span> <span class="nc">LRTable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="LRTable.read_table"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRTable.read_table">[docs]</a>    <span class="k">def</span> <span class="nf">read_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
            <span class="n">parsetab</span> <span class="o">=</span> <span class="n">module</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;import </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">module</span><span class="p">)</span>
            <span class="n">parsetab</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">parsetab</span><span class="o">.</span><span class="n">_tabversion</span> <span class="o">!=</span> <span class="n">__tabversion__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VersionError</span><span class="p">(</span><span class="s1">&#39;yacc table file version is out of date&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span> <span class="o">=</span> <span class="n">parsetab</span><span class="o">.</span><span class="n">_lr_action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span> <span class="o">=</span> <span class="n">parsetab</span><span class="o">.</span><span class="n">_lr_goto</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parsetab</span><span class="o">.</span><span class="n">_lr_productions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MiniProduction</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span> <span class="o">=</span> <span class="n">parsetab</span><span class="o">.</span><span class="n">_lr_method</span>
        <span class="k">return</span> <span class="n">parsetab</span><span class="o">.</span><span class="n">_lr_signature</span></div>

<div class="viewcode-block" id="LRTable.read_pickle"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRTable.read_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pickle</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">ImportError</span>

        <span class="n">in_f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>

        <span class="n">tabversion</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tabversion</span> <span class="o">!=</span> <span class="n">__tabversion__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VersionError</span><span class="p">(</span><span class="s1">&#39;yacc table file version is out of date&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_f</span><span class="p">)</span>
        <span class="n">signature</span>      <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span>   <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_f</span><span class="p">)</span>
        <span class="n">productions</span>    <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MiniProduction</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>

        <span class="n">in_f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">signature</span></div>

    <span class="c1"># Bind all production function names to callable objects in pdict</span>
<div class="viewcode-block" id="LRTable.bind_callables"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRTable.bind_callables">[docs]</a>    <span class="k">def</span> <span class="nf">bind_callables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">pdict</span><span class="p">)</span></div></div>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                           === LR Generator ===</span>
<span class="c1">#</span>
<span class="c1"># The following classes and functions are used to generate LR parsing tables on</span>
<span class="c1"># a grammar.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># digraph()</span>
<span class="c1"># traverse()</span>
<span class="c1">#</span>
<span class="c1"># The following two functions are used to compute set valued functions</span>
<span class="c1"># of the form:</span>
<span class="c1">#</span>
<span class="c1">#     F(x) = F&#39;(x) U U{F(y) | x R y}</span>
<span class="c1">#</span>
<span class="c1"># This is used to compute the values of Read() sets as well as FOLLOW sets</span>
<span class="c1"># in LALR(1) generation.</span>
<span class="c1">#</span>
<span class="c1"># Inputs:  X    - An input set</span>
<span class="c1">#          R    - A relation</span>
<span class="c1">#          FP   - Set-valued function</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="digraph"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.digraph">[docs]</a><span class="k">def</span> <span class="nf">digraph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">FP</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
        <span class="n">N</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">traverse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">FP</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">F</span></div>

<div class="viewcode-block" id="traverse"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.traverse">[docs]</a><span class="k">def</span> <span class="nf">traverse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">FP</span><span class="p">):</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
    <span class="n">N</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
    <span class="n">F</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">FP</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>             <span class="c1"># F(X) &lt;- F&#39;(x)</span>

    <span class="n">rel</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>               <span class="c1"># Get y&#39;s related to x</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">traverse</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">FP</span><span class="p">)</span>
        <span class="n">N</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">N</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">F</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">F</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
                <span class="n">F</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">N</span><span class="p">[</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MAXINT</span>
        <span class="n">F</span><span class="p">[</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">element</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">N</span><span class="p">[</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MAXINT</span>
            <span class="n">F</span><span class="p">[</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="LALRError"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LALRError">[docs]</a><span class="k">class</span> <span class="nc">LALRError</span><span class="p">(</span><span class="n">YaccError</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                             == LRGeneratedTable ==</span>
<span class="c1">#</span>
<span class="c1"># This class implements the LR table generation algorithm.  There are no</span>
<span class="c1"># public methods except for write()</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable">[docs]</a><span class="k">class</span> <span class="nc">LRGeneratedTable</span><span class="p">(</span><span class="n">LRTable</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;LALR&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SLR&#39;</span><span class="p">,</span> <span class="s1">&#39;LALR&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">LALRError</span><span class="p">(</span><span class="s1">&#39;Unsupported method </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="c1"># Set up the logger</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">NullLogger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>

        <span class="c1"># Internal attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span>     <span class="o">=</span> <span class="p">{}</span>        <span class="c1"># Action table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span>       <span class="o">=</span> <span class="p">{}</span>        <span class="c1"># Goto table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span>  <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">Productions</span>    <span class="c1"># Copy of grammar Production array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto_cache</span> <span class="o">=</span> <span class="p">{}</span>        <span class="c1"># Cache of computed gotos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span>   <span class="o">=</span> <span class="p">{}</span>        <span class="c1"># Cache of closures</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_count</span>    <span class="o">=</span> <span class="mi">0</span>         <span class="c1"># Internal counter used to detect cycles</span>

        <span class="c1"># Diagonistic information filled in by the table generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_conflict</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_conflict</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conflicts</span>     <span class="o">=</span> <span class="p">[]</span>        <span class="c1"># List of conflicts</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sr_conflicts</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_conflicts</span>  <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Build the tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">build_lritems</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">compute_first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">compute_follow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_parse_table</span><span class="p">()</span>

    <span class="c1"># Compute the LR(0) closure operation on I, where I is a set of LR(0) items.</span>

<div class="viewcode-block" id="LRGeneratedTable.lr0_closure"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.lr0_closure">[docs]</a>    <span class="k">def</span> <span class="nf">lr0_closure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Add everything in I to J</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">I</span><span class="p">[:]</span>
        <span class="n">didadd</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">didadd</span><span class="p">:</span>
            <span class="n">didadd</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">J</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">lr_after</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;lr0_added&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_count</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># Add B --&gt; .G to J</span>
                    <span class="n">J</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lr_next</span><span class="p">)</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">lr0_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_count</span>
                    <span class="n">didadd</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">J</span></div>

    <span class="c1"># Compute the LR(0) goto function goto(I,X) where I is a set</span>
    <span class="c1"># of LR(0) items and X is a grammar symbol.   This function is written</span>
    <span class="c1"># in a way that guarantees uniqueness of the generated goto sets</span>
    <span class="c1"># (i.e. the same goto set will never be returned as two different Python</span>
    <span class="c1"># objects).  With uniqueness, we can later do fast set comparisons using</span>
    <span class="c1"># id(obj) instead of element-wise comparison.</span>

<div class="viewcode-block" id="LRGeneratedTable.lr0_goto"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.lr0_goto">[docs]</a>    <span class="k">def</span> <span class="nf">lr0_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># First we look for a previously cached entry</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="nb">id</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">g</span>

        <span class="c1"># Now we generate the goto set in a way that guarantees uniqueness</span>
        <span class="c1"># of the result</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto_cache</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_next</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">lr_before</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">s1</span><span class="p">:</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">s</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">s1</span>
                <span class="n">gs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s1</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$end&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gs</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_closure</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
                <span class="n">s</span><span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto_cache</span><span class="p">[(</span><span class="nb">id</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span>
        <span class="k">return</span> <span class="n">g</span></div>

    <span class="c1"># Compute the LR(0) sets of item function</span>
<div class="viewcode-block" id="LRGeneratedTable.lr0_items"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.lr0_items">[docs]</a>    <span class="k">def</span> <span class="nf">lr0_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lr0_closure</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lr_next</span><span class="p">])]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">I</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Loop over the items in C and each grammar symbols</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Collect all of the symbols that could possibly be in the goto(I,X) sets</span>
            <span class="n">asyms</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ii</span><span class="o">.</span><span class="n">usyms</span><span class="p">:</span>
                    <span class="n">asyms</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">asyms</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_goto</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span> <span class="ow">or</span> <span class="nb">id</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">g</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
                <span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">C</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1">#                       ==== LALR(1) Parsing ====</span>
    <span class="c1">#</span>
    <span class="c1"># LALR(1) parsing is almost exactly the same as SLR except that instead of</span>
    <span class="c1"># relying upon Follow() sets when performing reductions, a more selective</span>
    <span class="c1"># lookahead set that incorporates the state of the LR(0) machine is utilized.</span>
    <span class="c1"># Thus, we mainly just have to focus on calculating the lookahead sets.</span>
    <span class="c1">#</span>
    <span class="c1"># The method used here is due to DeRemer and Pennelo (1982).</span>
    <span class="c1">#</span>
    <span class="c1"># DeRemer, F. L., and T. J. Pennelo: &quot;Efficient Computation of LALR(1)</span>
    <span class="c1">#     Lookahead Sets&quot;, ACM Transactions on Programming Languages and Systems,</span>
    <span class="c1">#     Vol. 4, No. 4, Oct. 1982, pp. 615-649</span>
    <span class="c1">#</span>
    <span class="c1"># Further details can also be found in:</span>
    <span class="c1">#</span>
    <span class="c1">#  J. Tremblay and P. Sorenson, &quot;The Theory and Practice of Compiler Writing&quot;,</span>
    <span class="c1">#      McGraw-Hill Book Company, (1985).</span>
    <span class="c1">#</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># compute_nullable_nonterminals()</span>
    <span class="c1">#</span>
    <span class="c1"># Creates a dictionary containing all of the non-terminals that might produce</span>
    <span class="c1"># an empty production.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.compute_nullable_nonterminals"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.compute_nullable_nonterminals">[docs]</a>    <span class="k">def</span> <span class="nf">compute_nullable_nonterminals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nullable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">num_nullable</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nullable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nullable</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nullable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nullable</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_nullable</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">num_nullable</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nullable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nullable</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># find_nonterminal_trans(C)</span>
    <span class="c1">#</span>
    <span class="c1"># Given a set of LR(0) items, this functions finds all of the non-terminal</span>
    <span class="c1"># transitions.    These are transitions in which a dot appears immediately before</span>
    <span class="c1"># a non-terminal.   Returns a list of tuples of the form (state,N) where state</span>
    <span class="c1"># is the state number and N is the nonterminal symbol.</span>
    <span class="c1">#</span>
    <span class="c1"># The input C is the set of LR(0) items.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.find_nonterminal_transitions"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.find_nonterminal_transitions">[docs]</a>    <span class="k">def</span> <span class="nf">find_nonterminal_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stateno</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_index</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">stateno</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lr_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trans</span><span class="p">:</span>
                            <span class="n">trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trans</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># dr_relation()</span>
    <span class="c1">#</span>
    <span class="c1"># Computes the DR(p,A) relationships for non-terminal transitions.  The input</span>
    <span class="c1"># is a tuple (state,N) where state is a number and N is a nonterminal symbol.</span>
    <span class="c1">#</span>
    <span class="c1"># Returns a list of terminals.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.dr_relation"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.dr_relation">[docs]</a>    <span class="k">def</span> <span class="nf">dr_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">nullable</span><span class="p">):</span>
        <span class="n">state</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">trans</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_goto</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">state</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_index</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lr_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
                        <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># This extra bit is to handle the start state</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Productions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$end&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">terms</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># reads_relation()</span>
    <span class="c1">#</span>
    <span class="c1"># Computes the READS() relation (p,A) READS (t,C).</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.reads_relation"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.reads_relation">[docs]</a>    <span class="k">def</span> <span class="nf">reads_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">empty</span><span class="p">):</span>
        <span class="c1"># Look for empty transitions</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">state</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">trans</span>

        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_goto</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">state</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_index</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lr_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">empty</span><span class="p">:</span>
                    <span class="n">rel</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rel</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># compute_lookback_includes()</span>
    <span class="c1">#</span>
    <span class="c1"># Determines the lookback and includes relations</span>
    <span class="c1">#</span>
    <span class="c1"># LOOKBACK:</span>
    <span class="c1">#</span>
    <span class="c1"># This relation is determined by running the LR(0) state machine forward.</span>
    <span class="c1"># For example, starting with a production &quot;N : . A B C&quot;, we run it forward</span>
    <span class="c1"># to obtain &quot;N : A B C .&quot;   We then build a relationship between this final</span>
    <span class="c1"># state and the starting state.   These relationships are stored in a dictionary</span>
    <span class="c1"># lookdict.</span>
    <span class="c1">#</span>
    <span class="c1"># INCLUDES:</span>
    <span class="c1">#</span>
    <span class="c1"># Computes the INCLUDE() relation (p,A) INCLUDES (p&#39;,B).</span>
    <span class="c1">#</span>
    <span class="c1"># This relation is used to determine non-terminal transitions that occur</span>
    <span class="c1"># inside of other non-terminal transition states.   (p,A) INCLUDES (p&#39;, B)</span>
    <span class="c1"># if the following holds:</span>
    <span class="c1">#</span>
    <span class="c1">#       B -&gt; LAT, where T -&gt; epsilon and p&#39; -L-&gt; p</span>
    <span class="c1">#</span>
    <span class="c1"># L is essentially a prefix (which may be empty), T is a suffix that must be</span>
    <span class="c1"># able to derive an empty string.  State p&#39; must lead to state p with the string L.</span>
    <span class="c1">#</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.compute_lookback_includes"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.compute_lookback_includes">[docs]</a>    <span class="k">def</span> <span class="nf">compute_lookback_includes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">nullable</span><span class="p">):</span>
        <span class="n">lookdict</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c1"># Dictionary of lookback relations</span>
        <span class="n">includedict</span> <span class="o">=</span> <span class="p">{}</span>       <span class="c1"># Dictionary of include relations</span>

        <span class="c1"># Make a dictionary of non-terminal transitions</span>
        <span class="n">dtrans</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trans</span><span class="p">:</span>
            <span class="n">dtrans</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Loop over all transitions and compute lookbacks and includes</span>
        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">trans</span><span class="p">:</span>
            <span class="n">lookb</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">includes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">C</span><span class="p">[</span><span class="n">state</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">N</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Okay, we have a name match.  We now follow the production all the way</span>
                <span class="c1"># through the state machine until we get the . on the right hand side</span>

                <span class="n">lr_index</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_index</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">state</span>
                <span class="k">while</span> <span class="n">lr_index</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lr_index</span> <span class="o">=</span> <span class="n">lr_index</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">lr_index</span><span class="p">]</span>

                    <span class="c1"># Check to see if this symbol and state are a non-terminal transition</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dtrans</span><span class="p">:</span>
                        <span class="c1"># Yes.  Okay, there is some chance that this is an includes relation</span>
                        <span class="c1"># the only way to know for certain is whether the rest of the</span>
                        <span class="c1"># production derives empty</span>

                        <span class="n">li</span> <span class="o">=</span> <span class="n">lr_index</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">while</span> <span class="n">li</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">li</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
                                <span class="k">break</span>      <span class="c1"># No forget it</span>
                            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">li</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nullable</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="n">li</span> <span class="o">=</span> <span class="n">li</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Appears to be a relation between (j,t) and (state,N)</span>
                            <span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

                    <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_goto</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>               <span class="c1"># Go to next set</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>      <span class="c1"># Go to next state</span>

                <span class="c1"># When we get here, j is the final state, now we have to locate the production</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">len</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># This look is comparing a production &quot;. A B C&quot; with &quot;A B C .&quot;</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">lr_index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">break</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lookb</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">includes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">includedict</span><span class="p">:</span>
                    <span class="n">includedict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">includedict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
            <span class="n">lookdict</span><span class="p">[(</span><span class="n">state</span><span class="p">,</span> <span class="n">N</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lookb</span>

        <span class="k">return</span> <span class="n">lookdict</span><span class="p">,</span> <span class="n">includedict</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># compute_read_sets()</span>
    <span class="c1">#</span>
    <span class="c1"># Given a set of LR(0) items, this function computes the read sets.</span>
    <span class="c1">#</span>
    <span class="c1"># Inputs:  C        =  Set of LR(0) items</span>
    <span class="c1">#          ntrans   = Set of nonterminal transitions</span>
    <span class="c1">#          nullable = Set of empty transitions</span>
    <span class="c1">#</span>
    <span class="c1"># Returns a set containing the read sets</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.compute_read_sets"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.compute_read_sets">[docs]</a>    <span class="k">def</span> <span class="nf">compute_read_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">ntrans</span><span class="p">,</span> <span class="n">nullable</span><span class="p">):</span>
        <span class="n">FP</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_relation</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nullable</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span>  <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reads_relation</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nullable</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">digraph</span><span class="p">(</span><span class="n">ntrans</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">FP</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># compute_follow_sets()</span>
    <span class="c1">#</span>
    <span class="c1"># Given a set of LR(0) items, a set of non-terminal transitions, a readset,</span>
    <span class="c1"># and an include set, this function computes the follow sets</span>
    <span class="c1">#</span>
    <span class="c1"># Follow(p,A) = Read(p,A) U U {Follow(p&#39;,B) | (p,A) INCLUDES (p&#39;,B)}</span>
    <span class="c1">#</span>
    <span class="c1"># Inputs:</span>
    <span class="c1">#            ntrans     = Set of nonterminal transitions</span>
    <span class="c1">#            readsets   = Readset (previously computed)</span>
    <span class="c1">#            inclsets   = Include sets (previously computed)</span>
    <span class="c1">#</span>
    <span class="c1"># Returns a set containing the follow sets</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.compute_follow_sets"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.compute_follow_sets">[docs]</a>    <span class="k">def</span> <span class="nf">compute_follow_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ntrans</span><span class="p">,</span> <span class="n">readsets</span><span class="p">,</span> <span class="n">inclsets</span><span class="p">):</span>
        <span class="n">FP</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">readsets</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">R</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">inclsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">digraph</span><span class="p">(</span><span class="n">ntrans</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">FP</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># add_lookaheads()</span>
    <span class="c1">#</span>
    <span class="c1"># Attaches the lookahead symbols to grammar rules.</span>
    <span class="c1">#</span>
    <span class="c1"># Inputs:    lookbacks         -  Set of lookback relations</span>
    <span class="c1">#            followset         -  Computed follow set</span>
    <span class="c1">#</span>
    <span class="c1"># This function directly attaches the lookaheads to productions contained</span>
    <span class="c1"># in the lookbacks set</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.add_lookaheads"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.add_lookaheads">[docs]</a>    <span class="k">def</span> <span class="nf">add_lookaheads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookbacks</span><span class="p">,</span> <span class="n">followset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">trans</span><span class="p">,</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">lookbacks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Loop over productions in lookback</span>
            <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lb</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">lookaheads</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">lookaheads</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">followset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">lookaheads</span><span class="p">[</span><span class="n">state</span><span class="p">]:</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">lookaheads</span><span class="p">[</span><span class="n">state</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># add_lalr_lookaheads()</span>
    <span class="c1">#</span>
    <span class="c1"># This function does all of the work of adding lookahead information for use</span>
    <span class="c1"># with LALR parsing</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.add_lalr_lookaheads"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.add_lalr_lookaheads">[docs]</a>    <span class="k">def</span> <span class="nf">add_lalr_lookaheads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
        <span class="c1"># Determine all of the nullable nonterminals</span>
        <span class="n">nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_nullable_nonterminals</span><span class="p">()</span>

        <span class="c1"># Find all non-terminal transitions</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_nonterminal_transitions</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="c1"># Compute read sets</span>
        <span class="n">readsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_read_sets</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">nullable</span><span class="p">)</span>

        <span class="c1"># Compute lookback/includes relations</span>
        <span class="n">lookd</span><span class="p">,</span> <span class="n">included</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_lookback_includes</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">nullable</span><span class="p">)</span>

        <span class="c1"># Compute LALR FOLLOW sets</span>
        <span class="n">followsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_follow_sets</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">readsets</span><span class="p">,</span> <span class="n">included</span><span class="p">)</span>

        <span class="c1"># Add all of the lookaheads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lookaheads</span><span class="p">(</span><span class="n">lookd</span><span class="p">,</span> <span class="n">followsets</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># lr_parse_table()</span>
    <span class="c1">#</span>
    <span class="c1"># This function constructs the parse tables for SLR or LALR</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="LRGeneratedTable.lr_parse_table"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.lr_parse_table">[docs]</a>    <span class="k">def</span> <span class="nf">lr_parse_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Productions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Productions</span>
        <span class="n">Precedence</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Precedence</span>
        <span class="n">goto</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span>         <span class="c1"># Goto array</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span>       <span class="c1"># Action array</span>
        <span class="n">log</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>             <span class="c1"># Logger for output</span>

        <span class="n">actionp</span> <span class="o">=</span> <span class="p">{}</span>                  <span class="c1"># Action production array (temporary)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Parsing method: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span><span class="p">)</span>

        <span class="c1"># Step 1: Construct C = { I0, I1, ... IN}, collection of LR(0) items</span>
        <span class="c1"># This determines the number of states</span>

        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_items</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span> <span class="o">==</span> <span class="s1">&#39;LALR&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_lalr_lookaheads</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="c1"># Build the parser table, state by state</span>
        <span class="n">st</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
            <span class="c1"># Loop over each production in I</span>
            <span class="n">actlist</span> <span class="o">=</span> <span class="p">[]</span>              <span class="c1"># List of actions</span>
            <span class="n">st_action</span>  <span class="o">=</span> <span class="p">{}</span>
            <span class="n">st_actionp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">st_goto</span>    <span class="o">=</span> <span class="p">{}</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;state </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;    (</span><span class="si">%d</span><span class="s1">) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;S&#39;&quot;</span><span class="p">:</span>
                            <span class="c1"># Start symbol. Accept!</span>
                            <span class="n">st_action</span><span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">st_actionp</span><span class="p">[</span><span class="s1">&#39;$end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># We are at the end of a production.  Reduce!</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span> <span class="o">==</span> <span class="s1">&#39;LALR&#39;</span><span class="p">:</span>
                                <span class="n">laheads</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lookaheads</span><span class="p">[</span><span class="n">st</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">laheads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Follow</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">laheads</span><span class="p">:</span>
                                <span class="n">actlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;reduce using rule </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">p</span><span class="p">)))</span>
                                <span class="n">r</span> <span class="o">=</span> <span class="n">st_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="c1"># Whoa. Have a shift/reduce or reduce/reduce conflict</span>
                                    <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="c1"># Need to decide on shift or reduce here</span>
                                        <span class="c1"># By default we favor shifting. Need to add</span>
                                        <span class="c1"># some precedence rules here.</span>

                                        <span class="c1"># Shift precedence comes from the token</span>
                                        <span class="n">sprec</span><span class="p">,</span> <span class="n">slevel</span> <span class="o">=</span> <span class="n">Precedence</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                                        <span class="c1"># Reduce precedence comes from rule being reduced (p)</span>
                                        <span class="n">rprec</span><span class="p">,</span> <span class="n">rlevel</span> <span class="o">=</span> <span class="n">Productions</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">prec</span>

                                        <span class="k">if</span> <span class="p">(</span><span class="n">slevel</span> <span class="o">&lt;</span> <span class="n">rlevel</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">slevel</span> <span class="o">==</span> <span class="n">rlevel</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rprec</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">)):</span>
                                            <span class="c1"># We really need to reduce here.</span>
                                            <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">number</span>
                                            <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                                            <span class="k">if</span> <span class="ow">not</span> <span class="n">slevel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rlevel</span><span class="p">:</span>
                                                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;  ! shift/reduce conflict for </span><span class="si">%s</span><span class="s1"> resolved as reduce&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">sr_conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">st</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reduce&#39;</span><span class="p">))</span>
                                            <span class="n">Productions</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">reduced</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">elif</span> <span class="p">(</span><span class="n">slevel</span> <span class="o">==</span> <span class="n">rlevel</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rprec</span> <span class="o">==</span> <span class="s1">&#39;nonassoc&#39;</span><span class="p">):</span>
                                            <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="c1"># Hmmm. Guess we&#39;ll keep the shift</span>
                                            <span class="k">if</span> <span class="ow">not</span> <span class="n">rlevel</span><span class="p">:</span>
                                                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;  ! shift/reduce conflict for </span><span class="si">%s</span><span class="s1"> resolved as shift&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">sr_conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">st</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;shift&#39;</span><span class="p">))</span>
                                    <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="c1"># Reduce/reduce conflict.   In this case, we favor the rule</span>
                                        <span class="c1"># that was defined first in the grammar file</span>
                                        <span class="n">oldp</span> <span class="o">=</span> <span class="n">Productions</span><span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span>
                                        <span class="n">pp</span> <span class="o">=</span> <span class="n">Productions</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="n">oldp</span><span class="o">.</span><span class="n">line</span> <span class="o">&gt;</span> <span class="n">pp</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                                            <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">number</span>
                                            <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                                            <span class="n">chosenp</span><span class="p">,</span> <span class="n">rejectp</span> <span class="o">=</span> <span class="n">pp</span><span class="p">,</span> <span class="n">oldp</span>
                                            <span class="n">Productions</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">reduced</span> <span class="o">+=</span> <span class="mi">1</span>
                                            <span class="n">Productions</span><span class="p">[</span><span class="n">oldp</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">reduced</span> <span class="o">-=</span> <span class="mi">1</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">chosenp</span><span class="p">,</span> <span class="n">rejectp</span> <span class="o">=</span> <span class="n">oldp</span><span class="p">,</span> <span class="n">pp</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">rr_conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">st</span><span class="p">,</span> <span class="n">chosenp</span><span class="p">,</span> <span class="n">rejectp</span><span class="p">))</span>
                                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;  ! reduce/reduce conflict for </span><span class="si">%s</span><span class="s1"> resolved using rule </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span>
                                                 <span class="n">a</span><span class="p">,</span> <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="n">LALRError</span><span class="p">(</span><span class="s1">&#39;Unknown conflict in state </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">st</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">number</span>
                                    <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                                    <span class="n">Productions</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">reduced</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lr_index</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">prod</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>       <span class="c1"># Get symbol right after the &quot;.&quot;</span>
                        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Terminals</span><span class="p">:</span>
                            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_goto</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="c1"># We are in a shift state</span>
                                <span class="n">actlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;shift and go to state </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">j</span><span class="p">))</span>
                                <span class="n">r</span> <span class="o">=</span> <span class="n">st_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="c1"># Whoa have a shift/reduce or shift/shift conflict</span>
                                    <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                                            <span class="k">raise</span> <span class="n">LALRError</span><span class="p">(</span><span class="s1">&#39;Shift/shift conflict in state </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">st</span><span class="p">)</span>
                                    <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="c1"># Do a precedence check.</span>
                                        <span class="c1">#   -  if precedence of reduce rule is higher, we reduce.</span>
                                        <span class="c1">#   -  if precedence of reduce is same and left assoc, we reduce.</span>
                                        <span class="c1">#   -  otherwise we shift</span>

                                        <span class="c1"># Shift precedence comes from the token</span>
                                        <span class="n">sprec</span><span class="p">,</span> <span class="n">slevel</span> <span class="o">=</span> <span class="n">Precedence</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                                        <span class="c1"># Reduce precedence comes from the rule that could have been reduced</span>
                                        <span class="n">rprec</span><span class="p">,</span> <span class="n">rlevel</span> <span class="o">=</span> <span class="n">Productions</span><span class="p">[</span><span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">prec</span>

                                        <span class="k">if</span> <span class="p">(</span><span class="n">slevel</span> <span class="o">&gt;</span> <span class="n">rlevel</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">slevel</span> <span class="o">==</span> <span class="n">rlevel</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rprec</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">)):</span>
                                            <span class="c1"># We decide to shift here... highest precedence to shift</span>
                                            <span class="n">Productions</span><span class="p">[</span><span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">reduced</span> <span class="o">-=</span> <span class="mi">1</span>
                                            <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                                            <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                                            <span class="k">if</span> <span class="ow">not</span> <span class="n">rlevel</span><span class="p">:</span>
                                                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;  ! shift/reduce conflict for </span><span class="si">%s</span><span class="s1"> resolved as shift&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">sr_conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">st</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;shift&#39;</span><span class="p">))</span>
                                        <span class="k">elif</span> <span class="p">(</span><span class="n">slevel</span> <span class="o">==</span> <span class="n">rlevel</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rprec</span> <span class="o">==</span> <span class="s1">&#39;nonassoc&#39;</span><span class="p">):</span>
                                            <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="c1"># Hmmm. Guess we&#39;ll keep the reduce</span>
                                            <span class="k">if</span> <span class="ow">not</span> <span class="n">slevel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rlevel</span><span class="p">:</span>
                                                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;  ! shift/reduce conflict for </span><span class="si">%s</span><span class="s1"> resolved as reduce&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">sr_conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">st</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reduce&#39;</span><span class="p">))</span>

                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="n">LALRError</span><span class="p">(</span><span class="s1">&#39;Unknown conflict in state </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">st</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">st_action</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                                    <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

            <span class="c1"># Print the actions associated with each terminal</span>
            <span class="n">_actprint</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">actlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">st_action</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%-15s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                        <span class="n">_actprint</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="c1"># Print the actions that were not used. (debugging)</span>
            <span class="n">not_used</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">actlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">st_action</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">st_actionp</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_actprint</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  ! </span><span class="si">%-15s</span><span class="s1"> [ </span><span class="si">%s</span><span class="s1"> ]&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                            <span class="n">not_used</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">_actprint</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">not_used</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="c1"># Construct the goto table for this state</span>

            <span class="n">nkeys</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ii</span><span class="o">.</span><span class="n">usyms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">:</span>
                        <span class="n">nkeys</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nkeys</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_goto</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr0_cidhash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">st_goto</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%-30s</span><span class="s1"> shift and go to state </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

            <span class="n">action</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="n">st_action</span>
            <span class="n">actionp</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="n">st_actionp</span>
            <span class="n">goto</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="n">st_goto</span>
            <span class="n">st</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># write()</span>
    <span class="c1">#</span>
    <span class="c1"># This function writes the LR parsing tables to a file</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.write_table"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.write_table">[docs]</a>    <span class="k">def</span> <span class="nf">write_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tabmodule</span><span class="p">,</span> <span class="n">outputdir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabmodule</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Won&#39;t overwrite existing tabmodule&quot;</span><span class="p">)</span>

        <span class="n">basemodulename</span> <span class="o">=</span> <span class="n">tabmodule</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputdir</span><span class="p">,</span> <span class="n">basemodulename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># </span><span class="si">%s</span><span class="s1"></span>
<span class="s1"># This file is automatically generated. Do not edit.</span>
<span class="s1"># pylint: disable=W,C,R</span>
<span class="s1">_tabversion = </span><span class="si">%r</span><span class="s1"></span>

<span class="s1">_lr_method = </span><span class="si">%r</span><span class="s1"></span>

<span class="s1">_lr_signature = </span><span class="si">%r</span><span class="s1"></span>
<span class="s1">    &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">__tabversion__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span><span class="p">,</span> <span class="n">signature</span><span class="p">))</span>

            <span class="c1"># Change smaller to 0 to go back to original tables</span>
            <span class="n">smaller</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Factor out names to try and make smaller</span>
            <span class="k">if</span> <span class="n">smaller</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nd</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">i</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[])</span>
                            <span class="n">items</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">_lr_action_items = {&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">:([&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;],[&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;]),&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">_lr_action = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">for _k, _v in _lr_action_items.items():</span>
<span class="s1">   for _x,_y in zip(_v[0],_v[1]):</span>
<span class="s1">      if not _x in _lr_action:  _lr_action[_x] = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">      _lr_action[_x][_k] = _y</span>
<span class="s1">del _lr_action_items</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">_lr_action = { &#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">):</span><span class="si">%r</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">smaller</span><span class="p">:</span>
                <span class="c1"># Factor out names to try and make smaller</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nd</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">i</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[])</span>
                            <span class="n">items</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">_lr_goto_items = {&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">:([&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;],[&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;]),&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">_lr_goto = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">for _k, _v in _lr_goto_items.items():</span>
<span class="s1">   for _x, _y in zip(_v[0], _v[1]):</span>
<span class="s1">       if not _x in _lr_goto: _lr_goto[_x] = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">       _lr_goto[_x][_k] = _y</span>
<span class="s1">del _lr_goto_items</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">_lr_goto = { &#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">):</span><span class="si">%r</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Write production table</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_lr_productions = [</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  (</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%d</span><span class="s1">),</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span><span class="p">,</span>
                                                          <span class="n">p</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">file</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  (</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,None,None,None),</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span></div>


    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># pickle_table()</span>
    <span class="c1">#</span>
    <span class="c1"># This function pickles the LR parsing tables to a supplied file object</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="LRGeneratedTable.pickle_table"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.LRGeneratedTable.pickle_table">[docs]</a>    <span class="k">def</span> <span class="nf">pickle_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pickle</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">__tabversion__</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_method</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">signature</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_action</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_goto</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">)</span>

            <span class="n">outp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_productions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
                    <span class="n">outp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">file</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">len</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">outp</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">)</span></div></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1">#                            === INTROSPECTION ===</span>
<span class="c1">#</span>
<span class="c1"># The following functions and classes are used to implement the PLY</span>
<span class="c1"># introspection features followed by the yacc() function itself.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># get_caller_module_dict()</span>
<span class="c1">#</span>
<span class="c1"># This function returns a dictionary containing all of the symbols defined within</span>
<span class="c1"># a caller further down the call stack.  This is used to get the environment</span>
<span class="c1"># associated with the yacc() call if none was provided.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="get_caller_module_dict"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.get_caller_module_dict">[docs]</a><span class="k">def</span> <span class="nf">get_caller_module_dict</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
    <span class="n">ldict</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">f_globals</span> <span class="o">!=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
        <span class="n">ldict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ldict</span></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># parse_grammar()</span>
<span class="c1">#</span>
<span class="c1"># This takes a raw grammar rule string and parses it into production data</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="parse_grammar"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.parse_grammar">[docs]</a><span class="k">def</span> <span class="nf">parse_grammar</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Split the doc string into lines</span>
    <span class="n">pstrings</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">lastp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dline</span> <span class="o">=</span> <span class="n">line</span>
    <span class="k">for</span> <span class="n">ps</span> <span class="ow">in</span> <span class="n">pstrings</span><span class="p">:</span>
        <span class="n">dline</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;|&#39;</span><span class="p">:</span>
                <span class="c1"># This is a continuation of a previous rule</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lastp</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: Misplaced &#39;|&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dline</span><span class="p">))</span>
                <span class="n">prodname</span> <span class="o">=</span> <span class="n">lastp</span>
                <span class="n">syms</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prodname</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lastp</span> <span class="o">=</span> <span class="n">prodname</span>
                <span class="n">syms</span>   <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">assign</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">assign</span> <span class="o">!=</span> <span class="s1">&#39;:&#39;</span> <span class="ow">and</span> <span class="n">assign</span> <span class="o">!=</span> <span class="s1">&#39;::=&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: Syntax error. Expected &#39;:&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dline</span><span class="p">))</span>

            <span class="n">grammar</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">file</span><span class="p">,</span> <span class="n">dline</span><span class="p">,</span> <span class="n">prodname</span><span class="p">,</span> <span class="n">syms</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Syntax error in rule </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dline</span><span class="p">,</span> <span class="n">ps</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">grammar</span></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># ParserReflect()</span>
<span class="c1">#</span>
<span class="c1"># This class represents information extracted for building a parser including</span>
<span class="c1"># start symbol, error function, tokens, precedence list, action functions,</span>
<span class="c1"># etc.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParserReflect"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect">[docs]</a><span class="k">class</span> <span class="nc">ParserReflect</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdict</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span>      <span class="o">=</span> <span class="n">pdict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>     <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span>    <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span>      <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">PlyLogger</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>

    <span class="c1"># Get all of the basic information</span>
<div class="viewcode-block" id="ParserReflect.get_all"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.get_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_error_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_tokens</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_precedence</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_pfunctions</span><span class="p">()</span></div>

    <span class="c1"># Validate all of the information</span>
<div class="viewcode-block" id="ParserReflect.validate_all"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_all">[docs]</a>    <span class="k">def</span> <span class="nf">validate_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_error_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_tokens</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_precedence</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_pfunctions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_modules</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span></div>

    <span class="c1"># Compute a signature over the grammar</span>
<div class="viewcode-block" id="ParserReflect.signature"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.signature">[docs]</a>    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfuncs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># validate_modules()</span>
    <span class="c1">#</span>
    <span class="c1"># This method checks to see if there are duplicated p_rulename() functions</span>
    <span class="c1"># in the parser module file.  Without this function, it is really easy for</span>
    <span class="c1"># users to make mistakes by cutting and pasting code fragments (and it&#39;s a real</span>
    <span class="c1"># bugger to try and figure out why the resulting parser doesn&#39;t work).  Therefore,</span>
    <span class="c1"># we just do a little regular expression pattern matching of def statements</span>
    <span class="c1"># to try and detect duplicates.</span>
    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="ParserReflect.validate_modules"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_modules">[docs]</a>    <span class="k">def</span> <span class="nf">validate_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Match def p_funcname(</span>
        <span class="n">fre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*def\s+(p_[a-zA-Z_0-9]*)\(&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">,</span> <span class="n">linen</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">counthash</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">linen</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">linen</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">fre</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">prev</span> <span class="o">=</span> <span class="n">counthash</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prev</span><span class="p">:</span>
                        <span class="n">counthash</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">linen</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcefile</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Function </span><span class="si">%s</span><span class="s1"> redefined. Previously defined on line </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                                         <span class="n">filename</span><span class="p">,</span> <span class="n">linen</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span></div>

    <span class="c1"># Get the start symbol</span>
<div class="viewcode-block" id="ParserReflect.get_start"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.get_start">[docs]</a>    <span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span></div>

    <span class="c1"># Validate the start symbol</span>
<div class="viewcode-block" id="ParserReflect.validate_start"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_start">[docs]</a>    <span class="k">def</span> <span class="nf">validate_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&#39;start&#39; must be a string&quot;</span><span class="p">)</span></div>

    <span class="c1"># Look for error handler</span>
<div class="viewcode-block" id="ParserReflect.get_error_func"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.get_error_func">[docs]</a>    <span class="k">def</span> <span class="nf">get_error_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p_error&#39;</span><span class="p">)</span></div>

    <span class="c1"># Validate the error function</span>
<div class="viewcode-block" id="ParserReflect.validate_error_func"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_error_func">[docs]</a>    <span class="k">def</span> <span class="nf">validate_error_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
                <span class="n">ismethod</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">):</span>
                <span class="n">ismethod</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&#39;p_error&#39; defined, but is not a function or method&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span>

            <span class="n">eline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_firstlineno</span>
            <span class="n">efile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_filename</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

            <span class="n">argcount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">-</span> <span class="n">ismethod</span>
            <span class="k">if</span> <span class="n">argcount</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: p_error() requires 1 argument&#39;</span><span class="p">,</span> <span class="n">efile</span><span class="p">,</span> <span class="n">eline</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># Get the tokens map</span>
<div class="viewcode-block" id="ParserReflect.get_tokens"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.get_tokens">[docs]</a>    <span class="k">def</span> <span class="nf">get_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No token list is defined&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tokens must be a list or tuple&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tokens is empty&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span></div>

    <span class="c1"># Validate the tokens</span>
<div class="viewcode-block" id="ParserReflect.validate_tokens"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_tokens">[docs]</a>    <span class="k">def</span> <span class="nf">validate_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Validate the tokens.</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Illegal token name &#39;error&#39;. Is a reserved word&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="n">terminals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Token </span><span class="si">%r</span><span class="s1"> multiply defined&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">terminals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>

    <span class="c1"># Get the precedence map (if any)</span>
<div class="viewcode-block" id="ParserReflect.get_precedence"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.get_precedence">[docs]</a>    <span class="k">def</span> <span class="nf">get_precedence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precedence&#39;</span><span class="p">)</span></div>

    <span class="c1"># Validate and parse the precedence map</span>
<div class="viewcode-block" id="ParserReflect.validate_precedence"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_precedence">[docs]</a>    <span class="k">def</span> <span class="nf">validate_precedence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">preclist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;precedence must be a list or tuple&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Bad precedence table&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Malformed precedence entry </span><span class="si">%s</span><span class="s1">. Must be (assoc, term, ..., term)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">return</span>
                <span class="n">assoc</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assoc</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;precedence associativity must be a string&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">return</span>
                <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;precedence items must be strings&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>
                    <span class="n">preclist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">term</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preclist</span> <span class="o">=</span> <span class="n">preclist</span></div>

    <span class="c1"># Get all p_functions from the grammar</span>
<div class="viewcode-block" id="ParserReflect.get_pfunctions"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.get_pfunctions">[docs]</a>    <span class="k">def</span> <span class="nf">get_pfunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p_functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;p_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;p_error&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">)):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;co_firstlineno&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">)</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">p_functions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>

        <span class="c1"># Sort all of the actions by line number; make sure to stringify</span>
        <span class="c1"># modules to make them sortable, since `line` may not uniquely sort all</span>
        <span class="c1"># p functions</span>
        <span class="n">p_functions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p_function</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">p_function</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">p_function</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">p_function</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">p_function</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfuncs</span> <span class="o">=</span> <span class="n">p_functions</span></div>

    <span class="c1"># Validate all of the p_functions</span>
<div class="viewcode-block" id="ParserReflect.validate_pfunctions"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.ParserReflect.validate_pfunctions">[docs]</a>    <span class="k">def</span> <span class="nf">validate_pfunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grammar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Check for non-empty symbols</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pfuncs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;no rules of the form p_rulename are defined&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfuncs</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcefile</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">):</span>
                <span class="n">reqargs</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reqargs</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">&gt;</span> <span class="n">reqargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Rule </span><span class="si">%r</span><span class="s1"> has too many arguments&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">&lt;</span> <span class="n">reqargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Rule </span><span class="si">%r</span><span class="s1"> requires an argument&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: No documentation string specified in function </span><span class="si">%r</span><span class="s1"> (ignored)&#39;</span><span class="p">,</span>
                                 <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parsed_g</span> <span class="o">=</span> <span class="n">parse_grammar</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">parsed_g</span><span class="p">:</span>
                        <span class="n">grammar</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Looks like a valid grammar rule</span>
                <span class="c1"># Mark the file in which defined.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

        <span class="c1"># Secondary validation step that looks for p_ definitions that are not functions</span>
        <span class="c1"># or functions that look like they might be grammar rules.</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;p_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;p_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="s1">&#39;p_error&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> not defined as a function&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
                   <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">doc</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Possible grammar rule </span><span class="si">%r</span><span class="s1"> defined without p_ prefix&#39;</span><span class="p">,</span>
                                             <span class="n">v</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span></div></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># yacc(module)</span>
<span class="c1">#</span>
<span class="c1"># Build a parser</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="yacc"><a class="viewcode-back" href="../../../api/PythonicGcodeMachine/PythonLexYacc/yacc.html#PythonicGcodeMachine.PythonLexYacc.yacc.yacc">[docs]</a><span class="k">def</span> <span class="nf">yacc</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;LALR&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">yaccdebug</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tabmodule</span><span class="o">=</span><span class="n">tab_module</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">check_recursion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_tables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debugfile</span><span class="o">=</span><span class="n">debug_file</span><span class="p">,</span>
         <span class="n">outputdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debuglog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errorlog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picklefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">tabmodule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tabmodule</span> <span class="o">=</span> <span class="n">tab_module</span>

    <span class="c1"># Reference to the parsing method of the last built parser</span>
    <span class="k">global</span> <span class="n">parse</span>

    <span class="c1"># If pickling is enabled, table files are not created</span>
    <span class="k">if</span> <span class="n">picklefile</span><span class="p">:</span>
        <span class="n">write_tables</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">errorlog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">errorlog</span> <span class="o">=</span> <span class="n">PlyLogger</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># Get the module dictionary used for the parser</span>
    <span class="k">if</span> <span class="n">module</span><span class="p">:</span>
        <span class="n">_items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">module</span><span class="p">)]</span>
        <span class="n">pdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_items</span><span class="p">)</span>
        <span class="c1"># If no __file__ or __package__ attributes are available, try to obtain them</span>
        <span class="c1"># from the __module__ instead</span>
        <span class="k">if</span> <span class="s1">&#39;__file__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;__file__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;__module__&#39;</span><span class="p">]]</span><span class="o">.</span><span class="vm">__file__</span>
        <span class="k">if</span> <span class="s1">&#39;__package__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pdict</span> <span class="ow">and</span> <span class="s1">&#39;__module__&#39;</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;__module__&#39;</span><span class="p">]],</span> <span class="s1">&#39;__package__&#39;</span><span class="p">):</span>
                <span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;__package__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;__module__&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">__package__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdict</span> <span class="o">=</span> <span class="n">get_caller_module_dict</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">outputdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If no output directory is set, the location of the output files</span>
        <span class="c1"># is determined according to the following rules:</span>
        <span class="c1">#     - If tabmodule specifies a package, files go into that package directory</span>
        <span class="c1">#     - Otherwise, files go in the same directory as the specifying module</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabmodule</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
            <span class="n">srcfile</span> <span class="o">=</span> <span class="n">tabmodule</span><span class="o">.</span><span class="vm">__file__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tabmodule</span><span class="p">:</span>
                <span class="n">srcfile</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;__file__&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">tabmodule</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">pkgname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;import </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pkgname</span><span class="p">)</span>
                <span class="n">srcfile</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pkgname</span><span class="p">],</span> <span class="s1">&#39;__file__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">outputdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">srcfile</span><span class="p">)</span>

    <span class="c1"># Determine if the module is package of a package or not.</span>
    <span class="c1"># If so, fix the tabmodule setting so that tables load correctly</span>
    <span class="n">pkg</span> <span class="o">=</span> <span class="n">pdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__package__&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pkg</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabmodule</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tabmodule</span><span class="p">:</span>
            <span class="n">tabmodule</span> <span class="o">=</span> <span class="n">pkg</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">tabmodule</span>



    <span class="c1"># Set start symbol if it&#39;s specified directly using an argument</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pdict</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>

    <span class="c1"># Collect parser information from the dictionary</span>
    <span class="n">pinfo</span> <span class="o">=</span> <span class="n">ParserReflect</span><span class="p">(</span><span class="n">pdict</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">errorlog</span><span class="p">)</span>
    <span class="n">pinfo</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YaccError</span><span class="p">(</span><span class="s1">&#39;Unable to build parser&#39;</span><span class="p">)</span>

    <span class="c1"># Check signature against table files (if any)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">signature</span><span class="p">()</span>

    <span class="c1"># Read the tables</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lr</span> <span class="o">=</span> <span class="n">LRTable</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">picklefile</span><span class="p">:</span>
            <span class="n">read_signature</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">picklefile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">read_signature</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">tabmodule</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optimize</span> <span class="ow">or</span> <span class="p">(</span><span class="n">read_signature</span> <span class="o">==</span> <span class="n">signature</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lr</span><span class="o">.</span><span class="n">bind_callables</span><span class="p">(</span><span class="n">pinfo</span><span class="o">.</span><span class="n">pdict</span><span class="p">)</span>
                <span class="n">parser</span> <span class="o">=</span> <span class="n">LRParser</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">error_func</span><span class="p">)</span>
                <span class="n">parse</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span>
                <span class="k">return</span> <span class="n">parser</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;There was a problem loading the table file: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">VersionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">debuglog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">debuglog</span> <span class="o">=</span> <span class="n">PlyLogger</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputdir</span><span class="p">,</span> <span class="n">debugfile</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open </span><span class="si">%r</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">debugfile</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="n">debuglog</span> <span class="o">=</span> <span class="n">NullLogger</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">debuglog</span> <span class="o">=</span> <span class="n">NullLogger</span><span class="p">()</span>

    <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Created by PLY version </span><span class="si">%s</span><span class="s1"> (http://www.dabeaz.com/ply)&#39;</span><span class="p">,</span> <span class="n">__version__</span><span class="p">)</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Validate the parser information</span>
    <span class="k">if</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">validate_all</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">YaccError</span><span class="p">(</span><span class="s1">&#39;Unable to build parser&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">error_func</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;no p_error() function is defined&#39;</span><span class="p">)</span>

    <span class="c1"># Create a grammar object</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="n">Grammar</span><span class="p">(</span><span class="n">pinfo</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>

    <span class="c1"># Set precedence level for terminals</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">preclist</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">grammar</span><span class="o">.</span><span class="n">set_precedence</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GrammarError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c1"># Add productions to the grammar</span>
    <span class="k">for</span> <span class="n">funcname</span><span class="p">,</span> <span class="n">gram</span> <span class="ow">in</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
        <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">prodname</span><span class="p">,</span> <span class="n">syms</span> <span class="o">=</span> <span class="n">gram</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">grammar</span><span class="o">.</span><span class="n">add_production</span><span class="p">(</span><span class="n">prodname</span><span class="p">,</span> <span class="n">syms</span><span class="p">,</span> <span class="n">funcname</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GrammarError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Set the grammar start symbols</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grammar</span><span class="o">.</span><span class="n">set_start</span><span class="p">(</span><span class="n">pinfo</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grammar</span><span class="o">.</span><span class="n">set_start</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GrammarError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YaccError</span><span class="p">(</span><span class="s1">&#39;Unable to build parser&#39;</span><span class="p">)</span>

    <span class="c1"># Verify the grammar structure</span>
    <span class="n">undefined_symbols</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">undefined_symbols</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sym</span><span class="p">,</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">undefined_symbols</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Symbol </span><span class="si">%r</span><span class="s1"> used, but not defined as a token or a rule&#39;</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">unused_terminals</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">unused_terminals</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">unused_terminals</span><span class="p">:</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Unused terminals:&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">unused_terminals</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Token </span><span class="si">%r</span><span class="s1"> defined, but not used&#39;</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>

    <span class="c1"># Print out all productions to the debug log</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Grammar&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grammar</span><span class="o">.</span><span class="n">Productions</span><span class="p">):</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Rule </span><span class="si">%-5d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="c1"># Find unused non-terminals</span>
    <span class="n">unused_rules</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">unused_rules</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">unused_rules</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Rule </span><span class="si">%r</span><span class="s1"> defined, but not used&#39;</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_terminals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;There is 1 unused token&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_terminals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;There are </span><span class="si">%d</span><span class="s1"> unused tokens&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_terminals</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_rules</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;There is 1 unused rule&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_rules</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;There are </span><span class="si">%d</span><span class="s1"> unused rules&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_rules</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Terminals, with rules where they appear&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">grammar</span><span class="o">.</span><span class="n">Terminals</span><span class="p">)</span>
        <span class="n">terms</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-20s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">grammar</span><span class="o">.</span><span class="n">Terminals</span><span class="p">[</span><span class="n">term</span><span class="p">]]))</span>

        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Nonterminals, with rules where they appear&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">nonterms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">grammar</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">)</span>
        <span class="n">nonterms</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nonterm</span> <span class="ow">in</span> <span class="n">nonterms</span><span class="p">:</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-20s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">nonterm</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">grammar</span><span class="o">.</span><span class="n">Nonterminals</span><span class="p">[</span><span class="n">nonterm</span><span class="p">]]))</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_recursion</span><span class="p">:</span>
        <span class="n">unreachable</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">find_unreachable</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">unreachable</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Symbol </span><span class="si">%r</span><span class="s1"> is unreachable&#39;</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>

        <span class="n">infinite</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">infinite_cycles</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">infinite</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Infinite recursion detected for symbol </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">inf</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">unused_prec</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">unused_precedence</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">assoc</span> <span class="ow">in</span> <span class="n">unused_prec</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Precedence rule </span><span class="si">%r</span><span class="s1"> defined for unknown symbol </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YaccError</span><span class="p">(</span><span class="s1">&#39;Unable to build parser&#39;</span><span class="p">)</span>

    <span class="c1"># Run the LRGeneratedTable on the grammar</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">errorlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Generating </span><span class="si">%s</span><span class="s1"> tables&#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

    <span class="n">lr</span> <span class="o">=</span> <span class="n">LRGeneratedTable</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">debuglog</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">num_sr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">sr_conflicts</span><span class="p">)</span>

        <span class="c1"># Report shift/reduce and reduce/reduce conflicts</span>
        <span class="k">if</span> <span class="n">num_sr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;1 shift/reduce conflict&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_sr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> shift/reduce conflicts&#39;</span><span class="p">,</span> <span class="n">num_sr</span><span class="p">)</span>

        <span class="n">num_rr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">rr_conflicts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_rr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;1 reduce/reduce conflict&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_rr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> reduce/reduce conflicts&#39;</span><span class="p">,</span> <span class="n">num_rr</span><span class="p">)</span>

    <span class="c1"># Write out conflicts to the output file</span>
    <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">sr_conflicts</span> <span class="ow">or</span> <span class="n">lr</span><span class="o">.</span><span class="n">rr_conflicts</span><span class="p">):</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Conflicts:&#39;</span><span class="p">)</span>
        <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">tok</span><span class="p">,</span> <span class="n">resolution</span> <span class="ow">in</span> <span class="n">lr</span><span class="o">.</span><span class="n">sr_conflicts</span><span class="p">:</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;shift/reduce conflict for </span><span class="si">%s</span><span class="s1"> in state </span><span class="si">%d</span><span class="s1"> resolved as </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="n">tok</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

        <span class="n">already_reported</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">rejected</span> <span class="ow">in</span> <span class="n">lr</span><span class="o">.</span><span class="n">rr_conflicts</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">rule</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span> <span class="ow">in</span> <span class="n">already_reported</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;reduce/reduce conflict in state </span><span class="si">%d</span><span class="s1"> resolved using rule (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
            <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;rejected rule (</span><span class="si">%s</span><span class="s1">) in state </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rejected</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;reduce/reduce conflict in state </span><span class="si">%d</span><span class="s1"> resolved using rule (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;rejected rule (</span><span class="si">%s</span><span class="s1">) in state </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rejected</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="n">already_reported</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">rule</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">rejected</span><span class="p">)))</span>

        <span class="n">warned_never</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">rejected</span> <span class="ow">in</span> <span class="n">lr</span><span class="o">.</span><span class="n">rr_conflicts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rejected</span><span class="o">.</span><span class="n">reduced</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rejected</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warned_never</span><span class="p">):</span>
                <span class="n">debuglog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rule (</span><span class="si">%s</span><span class="s1">) is never reduced&#39;</span><span class="p">,</span> <span class="n">rejected</span><span class="p">)</span>
                <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Rule (</span><span class="si">%s</span><span class="s1">) is never reduced&#39;</span><span class="p">,</span> <span class="n">rejected</span><span class="p">)</span>
                <span class="n">warned_never</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rejected</span><span class="p">)</span>

    <span class="c1"># Write the table file if requested</span>
    <span class="k">if</span> <span class="n">write_tables</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lr</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">tabmodule</span><span class="p">,</span> <span class="n">outputdir</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tabmodule</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">tabmodule</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t create </span><span class="si">%r</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tabmodule</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="c1"># Write a pickled version of the tables</span>
    <span class="k">if</span> <span class="n">picklefile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lr</span><span class="o">.</span><span class="n">pickle_table</span><span class="p">(</span><span class="n">picklefile</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">errorlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t create </span><span class="si">%r</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">picklefile</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="c1"># Build the parser</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">bind_callables</span><span class="p">(</span><span class="n">pinfo</span><span class="o">.</span><span class="n">pdict</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">LRParser</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">pinfo</span><span class="o">.</span><span class="n">error_func</span><span class="p">)</span>

    <span class="n">parse</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span>
    <span class="k">return</span> <span class="n">parser</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Fabrice Salvaire

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../static/jquery.js"></script>
        <script type="text/javascript" src="../../../static/underscore.js"></script>
        <script type="text/javascript" src="../../../static/doctools.js"></script>
        <script type="text/javascript" src="../../../static/language_data.js"></script>
        <script type="text/javascript" src="../../../static/getthecode.js"></script>
    

  

  <script type="text/javascript" src="../../../static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>